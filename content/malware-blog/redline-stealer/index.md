
---
title: Reversing Redline Stealer
description: Reversing Redline Stealer Pron Lure
toc: true
authors: c3rb3ru5d3d53c
tags:
  - redline
  - stealer
  - reversing
  - analysis
categories: malware
date: '2022-11-29'
draft: false
---

Muta from `SomeOrdinaryGamers` uploaded a video on Redline Stealer on Aug 14, 2022, which infected Martin Shkreli.

## Infection Chain

The infection chain starts with a download of `[BigTitsRoundAsses] 17.12.14 - Jazmyn [1080p].scr` from `pornleech[.]ch`, which creates three files in the `TEMP%` directory, `Che.mp3` (Autoit Interpreter), `Quella.mp3`, (BAT Script) and `Travolge.mp3` (AutoIT Script).

## Obfuscated BAT Script

Once extracted, the installer executes `cmd /c cmd < Quella.mp3 & ping -n 5 localhost`, which later creates `Mantenga.exe.pif`, which is an AutoIT interpreter.

PLACEHOLDER (FIGURE FOR DEOBFUSCATED THE BAT SCRIPT)

### Obfuscated AutoIT Script

Next, the AutoIT interpreter executes `i`.  Then the AutoIT script performs process hollowing, creates the process `jsc.exe` in suspended mode, hollows the process then injects the process with Redline Stealer.

PLACEHOLDER (ADD FIGURE FOR AU3 DEOBFUSCATOR)

Installer → Quella.mp3 (BAT) → Mantenga.exe.pif (Loader) → jsc.exe

Looks like they are doing process hollowing from the AutoIT script.

```text
CreateProcessW
NtWriteVirtualMemory
NtReadVirtualMemory
NtWriteVirtualMemory
NtProtectVirtualMemory
NtSetContextThread
NtResumeThread
NtUnmapViewOfSection
```

## Redline Stealer

Placeholder

### Initialization

Once executed, *Redline Stealer* checks the country of origin against an array of countries hard-coded in the binary.

```text
- Armenia
- Azerbaijan
- Belarus
- Kazakhstan
- Kyrgyzstan
- Moldova
- Tajikistan
- Uzbekistan
- Ukraine
- Russia
```
*Figure 1. Redline Stealer Near Russian Country Check List*

If `TimeZoneInfo.Local.Id` contains any of the near Russian countries or `CultureInfo.CurrentUICulture.EnglishName` is `null` from Figure 1, the program calls `Environment.Exit`.

If the field `Arguments.Message` is not an empty or a `null` string, it's decrypted by calling `StringDecrypt.Read` and subsequently presented to the user in a new thread message box. The string decryption routine implemented in Python is provided in *Figure 2*.

```python
import base64

class StringDecrypt():
    @staticmethod
	def Read(ciphertext, key):
	    key = key.encode()
	    ciphertext = base64.b64decode(ciphertext)
	    plaintext = []
	    for i in range(0, len(ciphertext)):
	        plaintext.append(ciphertext[i] ^ key[i % len(key)])
	    plaintext = bytes(plaintext).decode('utf-8')
	    return base64.b64decode(plaintext).decode('utf-8')
```
*Figure 2: Redline Stealer String Decryption Routine in Python*

Next, Redline Stealer creates a new class object of `ConnectionProvider`, which handles all C2 communication. Once the class object has been created, *Redline Stealer* decrypts all C2 servers from `Arguments.IP` with `StringDecrypt.Read`. Next, Redline Stealer splits the result using the delimiter `|` to create an array of C2 hosts. 

### C2 Communication

Once *Redline Stealer* has decrypted its array of C2 hosts, *Redline Stealer* connects to `net.tcp://95.217.35[.]153:9678/` using the SOAP protocol, the default for Windows Communication Foundation (WCF). Once the WCF `ChannelFactory` object is created, Redline Stealer sets the field `connector` as this object. Next, *Redline Stealer* sets the SOAP header name as `Authorization`, with the namespace `ns1`. If unable to connect to the first C2 address, in a loop, Redline Stealer sleeps by calling `Thread.Sleep` for 5 seconds before attempting the next C2 address in the C2 hosts array.

### Modules

| Entity   | Class | Application | Description       |
| -------- | ----- | ----------- | ----------------- |
| Entity12 | Hola  | Filezilla   | Filezilla Stealer |
|          |       |             |                   |

## Indicators of Compromise

| Type   | Indicator                                                        | Description                    |
| ------ | ---------------------------------------------------------------- | ------------------------------ |
| SHA256 | 532c47de5bdd433bea776290d27a741b09a1d5c5f2089e54eced922514a60799 | Redline Stealer Installer File |
| SHA256 | 3e8d604a5d545189c35d810845b3e2208e3c56081507b949ecb17a6bbd4decb1 | Messed Up PE File (Che.mp3)    |
| SHA256 | ac5f7f01c7ca6663810df33bfa62012368b6c17b7520943c094308f30adac766 | BAT Script (Quella.mp3)        |
| SHA256 | 454b381e98f092cab4e82f21a790c5ccd4dbd006e44925bcabd6c9289ea6700e | AutoIT Script  (Travolge.mp3)  |
| SHA256 | 3e26723394ade92f8163b5643960189cb07358b0f96529a477d37176d68aa0a0 | AutoIT Interpreter             |
| SHA256 | 454b381e98f092cab4e82f21a790c5ccd4dbd006e44925bcabd6c9289ea6700e | AutoIT Script                  |
| SHA256 | 676ae4b1ef05ee0ec754a970cce61a5f8d3093989a58c33087a3a5dca06364aa | Redline Stealer (Unpacked)     |
| IPv4   | 95.217.35[.]153                                                    | Redline Stealer C2                               |

## Detection

This section contains signatures to detect Redline Stealer and its infection chain.

### YARA

Placeholder

### Suricata

Placeholder

## Mitre Attack

| ID          | Tactic      | Technique   |
| ----------- | ----------- | ----------- |
| placeholder | placeholder | placeholder | 
