<!doctype html><html lang=en dir=ltr><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Reversing Redline Stealer | Malware Hell</title><meta name=generator content="Hugo Eureka 0.9.3"><link rel=stylesheet href=https://c3rb3ru5d3d53c.github.io/css/eureka.min.9cec6350e37e534b0338fa9a085bf06855de3b0f2dcf857e792e5e97b07ea905d4d5513db554cbc26a9c3da622bae92d.css><script defer src=https://c3rb3ru5d3d53c.github.io/js/eureka.min.fa9a6bf6d7a50bb635b4cca7d2ba5cf3dfb095ae3798773f1328f7950028b48c17d06276594e1b5f244a25a6c969a705.js></script>
<link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Noto+Serif+SC:wght@400;600;700&display=swap" as=style onload='this.onload=null,this.rel="stylesheet"'><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/styles/base16/solarized-light.min.css media=print onload='this.media="all",this.onload=null' crossorigin><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/highlight.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/dart.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/bash.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/cpp.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/python.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/c.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/vbscript.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/powershell.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/http.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/x86asm.min.js crossorigin></script>
<link rel=stylesheet href=https://c3rb3ru5d3d53c.github.io/css/highlightjs.min.2958991528e43eb6fc9b8c4f2b8e052f79c4010718e1d1e888a777620e9ee63021c2c57ec7417a3108019bb8c41943e6.css media=print onload='this.media="all",this.onload=null'><script defer type=text/javascript src=https://c3rb3ru5d3d53c.github.io/js/fontawesome.min.296475393ba1a7e77c7df93f4381e5e29446e1153a8c1ceb125313238efee6770e92e20f01a20522f025913011117e41.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ media=print onload='this.media="all",this.onload=null' crossorigin><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script defer src=https://cdn.jsdelivr.net/npm/mermaid@8.14.0/dist/mermaid.min.js integrity=sha384-atOyb0FxAgN9LyAc6PEf9BjgwLISyansgdH8/VXQH8p2o5vfrRgmGIJ2Sg22L0A0 crossorigin></script>
<link rel=icon type=image/png sizes=32x32 href=https://c3rb3ru5d3d53c.github.io/images/profile_hudffae30dddd93a90cdf89d35bb97314e_107726_32x32_fill_q75_box_center.jpg><link rel=apple-touch-icon sizes=180x180 href=https://c3rb3ru5d3d53c.github.io/images/profile_hudffae30dddd93a90cdf89d35bb97314e_107726_180x180_fill_q75_box_center.jpg><meta name=description content="Reversing Redline Stealer Pron Lure"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Malware Blog","item":"https://c3rb3ru5d3d53c.github.io/malware-blog/"},{"@type":"ListItem","position":2,"name":"Reversing Redline Stealer","item":"https://c3rb3ru5d3d53c.github.io/malware-blog/redline-stealer/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://c3rb3ru5d3d53c.github.io/malware-blog/redline-stealer/"},"headline":"Reversing Redline Stealer | Malware Hell","datePublished":"2022-11-29T00:00:00+00:00","dateModified":"2022-11-29T00:00:00+00:00","wordCount":1787,"author":{"@type":"Person","name":"c3rb3ru5d3d53c"},"publisher":{"@type":"Person","name":"c3rb3ru5d3d53c","logo":{"@type":"ImageObject","url":"https://c3rb3ru5d3d53c.github.io/images/profile.jpg"}},"description":"Reversing Redline Stealer Pron Lure"}</script><meta property="og:title" content="Reversing Redline Stealer | Malware Hell"><meta property="og:type" content="article"><meta property="og:image" content="https://c3rb3ru5d3d53c.github.io/images/profile.jpg"><meta property="og:url" content="https://c3rb3ru5d3d53c.github.io/malware-blog/redline-stealer/"><meta property="og:description" content="Reversing Redline Stealer Pron Lure"><meta property="og:locale" content="en"><meta property="og:site_name" content="Malware Hell"><meta property="article:published_time" content="2022-11-29T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-29T00:00:00+00:00"><meta property="article:section" content="malware-blog"><meta property="article:tag" content="redline"><meta property="article:tag" content="stealer"><meta property="article:tag" content="reversing"><meta property="article:tag" content="analysis"><meta property="og:see_also" content="https://c3rb3ru5d3d53c.github.io/malware-blog/darkcloud-stealer/"><meta property="og:see_also" content="https://c3rb3ru5d3d53c.github.io/documents/malware-reversing-rust/"><meta property="og:see_also" content="https://c3rb3ru5d3d53c.github.io/malware-blog/lockbit-v3-api-hashing/"><meta property="og:see_also" content="https://c3rb3ru5d3d53c.github.io/malware-blog/2022-07-04-bitter-apt-zxxz-backdoor/"><meta property="og:see_also" content="https://c3rb3ru5d3d53c.github.io/documents/what-is-a-dll/"><meta property="og:see_also" content="https://c3rb3ru5d3d53c.github.io/documents/deobfuscating-scripts/"><body class="flex min-h-screen flex-col"><header class="min-h-16 pl-scrollbar bg-secondary-bg fixed z-50 flex w-full items-center shadow-sm"><div class="mx-auto w-full max-w-screen-xl"><script>let storageColorScheme=localStorage.getItem("lightDarkMode");((storageColorScheme=="Auto"||storageColorScheme==null)&&window.matchMedia("(prefers-color-scheme: dark)").matches||storageColorScheme=="Dark")&&document.getElementsByTagName("html")[0].classList.add("dark")</script><nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0"><a href=/ class="me-6 text-primary-text text-xl font-bold">Malware Hell</a>
<button id=navbar-btn class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
<i class="fas fa-bars"></i></button><div id=target class="hidden block md:flex md:grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20"><div class="md:flex md:h-16 text-sm md:grow pb-4 md:pb-0 border-b md:border-b-0"><a href=/malware-blog/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 selected-menu-item me-4">Malware Blog</a>
<a href=/personal-blog/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">Personal Blog</a>
<a href=/iocs/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">IOCs</a>
<a href=https://github.com/c3rb3ru5d3d53c/signatures/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">Signatures</a>
<a href=/documents/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">Documents</a></div><div class=flex><div class="relative pt-4 md:pt-0"><div class="cursor-pointer hover:text-eureka" id=lightDarkMode><i class="fas fa-adjust"></i></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id=is-open></div><div class="absolute flex flex-col start-0 md:start-auto end-auto md:end-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40" id=lightDarkOptions><span class="px-4 py-1 hover:text-eureka" name=Light>Light</span>
<span class="px-4 py-1 hover:text-eureka" name=Dark>Dark</span>
<span class="px-4 py-1 hover:text-eureka" name=Auto>Auto</span></div></div></div></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id=is-open-mobile></div></nav><script>let element=document.getElementById("lightDarkMode");storageColorScheme==null||storageColorScheme=="Auto"?document.addEventListener("DOMContentLoaded",()=>{window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",switchDarkMode)}):storageColorScheme=="Light"?(element.firstElementChild.classList.remove("fa-adjust"),element.firstElementChild.setAttribute("data-icon","sun"),element.firstElementChild.classList.add("fa-sun")):storageColorScheme=="Dark"&&(element.firstElementChild.classList.remove("fa-adjust"),element.firstElementChild.setAttribute("data-icon","moon"),element.firstElementChild.classList.add("fa-moon")),document.addEventListener("DOMContentLoaded",()=>{getcolorscheme(),switchBurger()})</script></div></header><main class="grow pt-16"><div class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl lg:px-4 xl:px-8"><div class="grid grid-cols-2 gap-4 lg:grid-cols-8 lg:pt-12"><div class="bg-secondary-bg col-span-2 rounded px-6 py-8 lg:col-span-6"><article class=prose><h1 class=mb-4>Reversing Redline Stealer</h1><div class="text-tertiary-text not-prose mt-2 flex flex-row flex-wrap items-center"><div class="me-6 my-2"><i class="fas fa-calendar me-1"></i>
<span>2022-11-29</span></div><div class="me-6 my-2"><i class="fas fa-clock me-1"></i>
<span>9 min read</span></div><div class="me-6 my-2"><i class="fas fa-folder me-1"></i>
<a href=https://c3rb3ru5d3d53c.github.io/categories/malware/ class=hover:text-eureka>malware</a></div></div><h2 id=situation>Situation</h2><p>Muta from <code>SomeOrdinaryGamers</code> uploaded a video on <em>Redline Stealer</em> on Aug 14, 2022, which infected Martin Shkreli.</p><h3 id=key-points>Key Points</h3><ul><li><em>Redline Stealer</em> has the ability to communicate with multiple C2 hosts.</li><li><em>Redline Stealer</em> has the ability to present a message box to the user upon execution.</li><li><em>Redline Stealer</em> communicates with the C2 server using Simple Object Access Protocol (SOAP).</li><li><em>Redline Stealer</em> exits if it detects the infected machine is from a near Russian countries.</li><li><em>Redline Stealer</em> executes its modules in random order to potentially evade heuritic detection.</li></ul><h2 id=infection-chain>Infection Chain</h2><p>The infection chain starts with a download of <code>[BigTitsRoundAsses] 17.12.14 - Jazmyn [1080p].scr</code> from <code>pornleech[.]ch</code>, which creates three files in the <code>TEMP%</code> directory, <code>Che.mp3</code> (Autoit Interpreter), <code>Quella.mp3</code>, (BAT Script) and <code>Travolge.mp3</code> (AutoIT Script).</p><h2 id=obfuscated-bat-script>Obfuscated BAT Script</h2><p>Once extracted, the installer executes <code>cmd /c cmd &lt; Quella.mp3 & ping -n 5 localhost</code>, which later creates <code>Mantenga.exe.pif</code>, which is an AutoIT interpreter.</p><p>PLACEHOLDER (FIGURE FOR DEOBFUSCATED THE BAT SCRIPT)</p><h3 id=obfuscated-autoit-script>Obfuscated AutoIT Script</h3><p>Next, the AutoIT interpreter executes <code>i</code>. Then the AutoIT script performs process hollowing, creates the process <code>jsc.exe</code> in suspended mode, hollows the process then injects the process with Redline Stealer.</p><p>PLACEHOLDER (ADD FIGURE FOR AU3 DEOBFUSCATOR)</p><p>Installer → Quella.mp3 (BAT) → Mantenga.exe.pif (Loader) → jsc.exe</p><p>Looks like they are doing process hollowing from the AutoIT script.</p><pre><code class=language-text>CreateProcessW
NtWriteVirtualMemory
NtReadVirtualMemory
NtWriteVirtualMemory
NtProtectVirtualMemory
NtSetContextThread
NtResumeThread
NtUnmapViewOfSection
</code></pre><h2 id=redline-stealer>Redline Stealer</h2><p><a href=https://malpedia.caad.fkie.fraunhofer.de/details/win.redline_stealer>Redline Stealer</a> is an information stealing malware available for purchase on underground forums and sells standalone and as a subscription service. This section of the blog is a technical analysis of Redline Stealer and its capabilities.</p><h3 id=language-check>Language Check</h3><p>Once executed, <em>Redline Stealer</em> checks the country of origin against Armenia, Azerbaijan, Belarus, Kazakhstan, Kyrgyzstan, Moldova, Tajikistan, Uzbekistan, Ukraine, and Russia. Next, if <code>TimeZoneInfo.Local.Id</code> contains any of the hard-coded disallowed countries or <code>CultureInfo.CurrentUICulture.EnglishName</code> is <code>null</code> the program calls <code>Environment.Exit</code>.</p><h2 id=string-decryption>String Decryption</h2><p>To decrypt strings, <em>Redline Stealer</em> calls <code>StrinDecrypt.Read</code>, which base64-decodes the ciphertext, then performs a rotating XOR operation using the key user string (<code>#US</code>) <code>Kenners</code>.</p><pre><code class=language-python>import base64

class StringDecrypt():
    @staticmethod
	def Read(ciphertext, key):
	    key = key.encode()
	    ciphertext = base64.b64decode(ciphertext)
	    plaintext = []
	    for i in range(0, len(ciphertext)):
	        plaintext.append(ciphertext[i] ^ key[i % len(key)])
	    plaintext = bytes(plaintext).decode('utf-8')
	    return base64.b64decode(plaintext).decode('utf-8')
</code></pre><p><em>Figure 1. Redline Stealer String Decryption Routine in Python</em></p><h2 id=user-message>User Message</h2><p>If the field <code>Arguments.Message</code> is not an empty or a <code>null</code> string, it is decrypted by calling <code>StringDecrypt.Read</code> (Figure 1) and subsequently presented to the user in a message box. The execution of <em>Redline Stealer</em> is not halted during this process, as the message box is created using a new thread. This functionality in Redline Stealer allows operators to present messages to users, such as fake error messages and more.</p><h3 id=c2-communication>C2 Communication</h3><p><em>Redline Stealer</em> uses SOAP messaging protocol to communicate with the C2 server. This section is a technical analysis of how <em>Redline Stealer</em> communicates with its C2 server.</p><h4 id=establish-connection>Establish Connection</h4><p>To establish a connection with the C2 server, Redline Stealer creates a new class object of <code>ConnectionProvider</code>, which handles all C2 communication. Once created, <em>Redline Stealer</em> decrypts all C2 servers from <code>Arguments.IP</code> with <code>StringDecrypt.Read</code> (Figure 1). Next, <em>Redline Stealer</em> splits the result using the delimiter <code>|</code> to create an array of C2 hosts. Once <em>Redline Stealer</em> has decrypted its array of C2 hosts, <em>Redline Stealer</em> connects to <code>net.tcp://95.217.35[.]153:9678/</code> using SOAP protocol, the default for Windows Communication Foundation (WCF). Once the WCF <code>ChannelFactory</code> object is created, <em>Redline Stealer</em> sets the field <code>connector</code> as this object. Next, <em>Redline Stealer</em> sets the SOAP header name as <code>Authorization</code>, with the namespace <code>ns1</code>. If unable to connect to the first C2 address, in a loop, <em>Redline Stealer</em> sleeps by calling <code>Thread.Sleep</code> for 5 seconds before attempting the next C2 address in the C2 hosts array. This means Redline Stealer can contain multiple C2 address, increasing the probability one of the C2 address will be operational.</p><h4 id=get-settings>Get Settings</h4><p><em>Redline Stealer</em> creates the data contract class <code>SettingsStruct</code>, which contains data members. These data members are the settings <em>Redline Stealer</em> uses during its execution, which are obtained from the C2 server (Table 1).</p><table><thead><tr><th>Type</th><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>bool</td><td>Id1</td><td>Unknown</td></tr><tr><td>bool</td><td>FileSearch</td><td>Enable File Stealing Module</td></tr><tr><td>bool</td><td>Filezilla</td><td>Enable Filezilla Module</td></tr><tr><td>bool</td><td>Wallets</td><td>Enable Wallet Stealing Module</td></tr><tr><td>bool</td><td>GetImageBase</td><td>Enable Collection of Image Base</td></tr><tr><td>bool</td><td>ScanFiles</td><td>Enable Scanning Files</td></tr><tr><td>bool</td><td>VPN</td><td>Enable Stealing VPN Credentials</td></tr><tr><td>bool</td><td>GameLaunchers</td><td>Enable Stealing Game Launcher Information</td></tr><tr><td>list&lt;string></td><td>FileSearchPatterns</td><td>File Search Pattern List</td></tr><tr><td>list&lt;string></td><td>BrowserPaths</td><td>Browser Path List</td></tr><tr><td>list&lt;string></td><td>Id12</td><td>Unknown</td></tr><tr><td>list&lt;Entity17></td><td>AdditionalWallets</td><td>Additional Wallets to Steal</td></tr><tr><td><em>Table 1. Redline Stealer Settings Data Contract Members</em></td><td></td><td></td></tr></tbody></table><h4 id=result-data-contract>Result Data Contract</h4><p><em>Redline Stealer</em> stores results of data collected from the victim machine in a data contract, which is created with the data member <code>ID</code>. The value of this data member is <code>100822</code> and originates from <code>Arguments.ID</code>, which is decrypted using <code>StringDecrypt.Read</code>.</p><p>PLACEHOLDER (What does this <code>ID</code> do?)</p><h3 id=modules>Modules</h3><p><em>Redline Stealer</em> creates the class <code>EntityResolver</code>, which is created from the template method <code>ItemBase.Extract</code>. If <code>Arguments.Version</code> is not equal to <code>1</code>, an instance of <code>FullInfoSender</code> is returned, otherwise an instance of <code>PartsSender</code> is returned. In this case, <code>Arguments.Version</code> is set <code>1</code>, which returns an instance of <code>PartsSender</code>.</p><p>Next, in a while loop, <em>Redline Stealer</em> executes the <code>Invoker</code> method from the <code>PartsSender</code> instance. Once executed, Redline Stealer initializes the data contract <code>SystemInfo</code>, which will later be populated with data stolen from the infected machine. Next, if the directory <code>%AppData%\Yandex\YaAddon</code> does not exist, Redline Stealer creates the directory. Otherwise, if the directory creation time is less than three months old, the directory is deleted and created again. Once completed, <em>Redline Stealer</em> executes modules in the module groups <code>First</code> and <code>Main</code> in random order (Table 2).</p><table><thead><tr><th>Module Group</th><th>Module Name</th><th>Description</th></tr></thead><tbody><tr><td>First</td><td>GetUsername</td><td>Gets Username</td></tr><tr><td>First</td><td>GetMonitorProperites</td><td>Gets Monitor Properties</td></tr><tr><td>First</td><td>GetOS</td><td>Gets OS Name</td></tr><tr><td>First</td><td>GetAssemblyLocation</td><td>Obtains Executing Assembly Location</td></tr><tr><td>First</td><td>GetUUID</td><td>Created a UUID</td></tr><tr><td>First</td><td>GetTimezone</td><td>Gets Timezone</td></tr><tr><td>Main</td><td>GetHardwareInfo</td><td>Get Hardware Information</td></tr><tr><td>Main</td><td>GetBrowsers</td><td>Steal Browser Data</td></tr><tr><td>Main</td><td>GetListOfPrograms</td><td>Get List of Programs</td></tr><tr><td>Main</td><td>GetAVs</td><td>Get List of Security Products</td></tr><tr><td>Main</td><td>GetProcesses</td><td>Get List of Processes</td></tr><tr><td>Main</td><td>GetLanguages</td><td>Get Languages</td></tr><tr><td>Main</td><td>GetTelegramProfiles</td><td>Enumerate Telegram Profiles</td></tr><tr><td>Main</td><td>MaybeMozillaStealer</td><td>Maybe Steal Data From Mozilla</td></tr><tr><td>Main</td><td>GetFileSearch</td><td>Get File Search Results</td></tr><tr><td>Main</td><td>StealWallets</td><td>Steal Crypto Wallets</td></tr><tr><td>Main</td><td>StealDiscord</td><td>Steal Discord Tokens</td></tr><tr><td>Main</td><td>GetGameLaunchers</td><td>Steal Game Launcher Data</td></tr><tr><td>Main</td><td>GetVPN</td><td>Steal VPN Credentials</td></tr><tr><td>Main</td><td>GetImageBase</td><td>Get Executing Assembly Image Base</td></tr><tr><td><em>Table 2. Redline Stealer Module Groups</em></td><td></td><td></td></tr></tbody></table><p>The modules in the group <code>First</code> only collect data, which is later sent to the C2 server, whereas the modules in the group <code>Main</code> send data within each module. This could mean the modules in the <code>First</code> group are working on being ported to the <code>Main</code> group.</p><h4 id=getavs-defenders>GetAVs (defenders)</h4><p>This module performs the WMI queries provided in Figure 2, against <code>ROOT\\SecurityCenter</code> and <code>ROOT\\SecurityCenter2</code>.</p><pre><code class=language-text>SELECT * FROM AntivirusProduct
SELECT * FROM AntiSpyWareProduct
SELECT * FROM FirewallProduct
</code></pre><p><em>Figure 2. Redline Stealer WMI Queries</em></p><p>Once completed, the results are appended to a list, which is sent to the C2 server.</p><h4 id=gethardwareinfo-hardwares>GetHardwareInfo (hardwares)</h4><p>This module performs the WMI query <code>SELECT * FROM Win32_Processor</code>, collecting the <code>Name</code> and <code>NumberOfCores</code> of the infected endpoint. Additionally, another WMI query is performed on <code>root\\CIMV2</code>, with the query <code>SELECT * FROM Win32_VideoController</code>, collecting the <code>AdaperRAM</code> and <code>Name</code>. The results from both of these queries are stored in a template list. Once completed, Redline Stealer appends another structure with the hard-coded key as <code>Total of RAM</code> with the value <code>4095.46 MB or 4294397952</code>. Next, the data is sent to the C2 server.</p><h4 id=listofprograms-softwares>ListOfPrograms (softwares)</h4><p>This module opens the sub registry key <code>HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall</code>. Next, the sub key names are iterated for their <code>DisplayName</code> and associated <code>DisplayVersion</code>. Once these values are obtained, they are added to a list of strings in the format described in Figure 3.</p><pre><code class=language-text>DisplayName0 [DisplayVersion0]
DisplayName1 [Displayversion1]
DisplayName3 [Displayversion3]
...
</code></pre><p>Figure 3. Redline Stealer Program List Module Structure</p><p>Next, the results are sent to the C2 server.</p><h4 id=getbrowsers>GetBrowsers</h4><p>If the infected endpoint is 32-bit Redline Stealer opens the registry key <code>SOFTWARE\\Clients\\StartMenuInternet</code>, otherwise it reads <code>SOFTWARE\\WOW6432Node\\Clients\\StartMenuInternet</code>. Once opened, Redline Stealer iterates the sub key names, collecting the <code>BrowserName</code> and the <code>FileVersion</code> from <code>shell\\open\\command</code> (default file association). If the <code>FileVersion</code> cannot be obtained, Redline Stealer sets <code>BrowserVersion</code> to <code>Unknown Version</code>. Next, the resulting data contract structure is appended to the list template and sent to the C2 server.</p><h4 id=listprocesses-processes>ListProcesses (processes)</h4><p>Redline Stealer performs the WMI query <code>SELECT * FROM Win32_Processes Where SessionId='&lt;current-processes-session-id>'</code>. Once completed, the results are parsed for <code>ProcessId</code>, <code>Name</code>, and <code>CommandLine</code>. The structure of the data collected is provided in Figure 4.</p><pre><code class=language-text>ID: &lt;ProcessId&gt;, Name: &lt;Name&gt;, CommandLine: &lt;CommandLine&gt;
</code></pre><p><em>Figure 4. Redline Stealer Process List Structure</em></p><h4 id=languages>Languages</h4><p>To collect languages, <em>Redline Stealer</em> iterates <code>InputLanguages.InstalledInputLanguages</code>, appending the language <code>EnglishName</code> to a list of strings. Once the results have been collected, they are sent to the C2 server.</p><h4 id=gettelegramprofiles>GetTelegramProfiles</h4><p>To scan for profiles, <em>Redline Stealer</em> calls the <code>FileScanning.Search</code> method, which takes an array of scanners classes to process. In this case, the only scanner class that is passed is <code>TelegramScanner</code>. Each scanner has two methods, <code>Find</code> to locate interesting directories, and <code>Collect</code> to obtain information.</p><p>To collect a list of Telegram profiles, <em>Redline Stealer</em> first checks if the process <code>Telegram.exe</code> is currently running, if this is the case, Redline Stealer adds the directory where <code>Telegram.exe</code> exists and the folder <code>\tdata</code>, which contains Telegram session data to a list of the type <code>ScannerArgsStruct</code>, which is a data contract consisting of the members <code>Count</code>, <code>Directory</code>, <code>SearchPattern</code>, and <code>Recursive</code> (Table 3.).</p><table><thead><tr><th>Type</th><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>string</td><td>Count</td><td>Number of Items Found</td></tr><tr><td>string</td><td>Directory</td><td>Directory to Search</td></tr><tr><td>string</td><td>SearchPattern</td><td>Search Pattern String</td></tr><tr><td>bool</td><td>Recursive</td><td>Recursive Search or Not</td></tr><tr><td><em>Table 3. Redline Stealer ScannerArgs Data Contract</em></td><td></td><td></td></tr></tbody></table><p>Next, if <em>Redline Stealer</em> is unable to find a currently running process of <code>Telegram.exe</code>, <em>Redline Stealer</em> will add the directory <code>%AppData%\Telegram Desktop\tdata\</code> to the list of <code>ScannerArgsStruct</code> data contracts.</p><p><em>Redline Stealer</em> in this process considers any filenames with a length of 16 in the Telegram <code>\tdata</code> folder a potential profile.</p><h4 id=stealwallets>StealWallets</h4><pre><code class=language-text>ffnbelfdoeiohenkjibnmadjiehjhajb|YoroiWallet
ibnejdfjmmkpcnlpebklmnkoeoihofec|Tronlink
jbdaocneiiinmjbjlgalhcelgbejmnid|NiftyWallet
nkbihfbeogaeaoehlefnkodbefgpgknn|Metamask
afbcbjpbpfadlkmhmclhkeeodmamcflc|MathWallet
hnfanknocfeofbddgcijnmhnfnkdnaad|Coinbase
fhbohimaelbohpjbbldcngcnapndodjp|BinanceChain
odbfpeeihdkbihmopkbjmoonfanlbfcl|BraveWallet
hpglfhgfnhbgpjdenjgmdgoeiappafln|GuardaWallet
blnieiiffboillknjnepogjhkgnoapac|EqualWallet
cjelfplplebdjjenllpjcblmjkfcffne|JaxxxLiberty
fihkakfobkmkjojpchpfgcmhfjnmnfpi|BitAppWallet
kncchdigobghenbbaddojjnnaogfppfj|iWallet
amkmjjmmflddogmhpjloimipbofnfjih|Wombat
fhilaheimglignddkjgofkcbgekhenbh|AtomicWallet
nlbmnnijcnlegkjjpcfjclmcfggfefdm|MewCx
nanjmdknhkinifnkgdcggcfnhdaammmj|GuildWallet
nkddgncdjgjfcddamfgcmfnlhccnimig|SaturnWallet
fnjhmkhhmkbjkkabndcnnogagogbneec|RoninWallet
aiifbnbfobpmeekipheeijimdpnlpgpp|TerraStation
fnnegphlobjdpkhecapkijjdkgcjhkib|HarmonyWallet
aeachknmefphepccionboohckonoeemg|Coin98Wallet
cgeeodpfagjceefieflmdfphplkenlfk|TonCrystal
pdadjkfkgcafgbceimcpbkalnfnepbnk|KardiaChain
bfnaelmomeimhlpmgjnjophhpkkoljpa|Phantom
fhilaheimglignddkjgofkcbgekhenbh|Oxygen
mgffkfbidihjpoaomajlbgchddlicgpn|PaliWallet
aodkkagnadcbobfpggfnjeongemjbjca|BoltX
kpfopkelmapcoipemfendmdcghnegimn|LiqualityWallet
hmeobnfnfcmdkdcmlblgagmfpfboieaf|XdefiWallet
lpfcbjknijpeeillifnkikgncikgfhdo|NamiWallet
dngmlblcodfobpdpecaadgfbcggfjfnm|MaiarDeFiWallet
ffnbelfdoeiohenkjibnmadjiehjhajb|YoroiWallet
ibnejdfjmmkpcnlpebklmnkoeoihofec|Tronlink
jbdaocneiiinmjbjlgalhcelgbejmnid|NiftyWallet
nkbihfbeogaeaoehlefnkodbefgpgknn|Metamask
afbcbjpbpfadlkmhmclhkeeodmamcflc|MathWallet
hnfanknocfeofbddgcijnmhnfnkdnaad|Coinbase
fhbohimaelbohpjbbldcngcnapndodjp|BinanceChain
odbfpeeihdkbihmopkbjmoonfanlbfcl|BraveWallet
hpglfhgfnhbgpjdenjgmdgoeiappafln|GuardaWallet
blnieiiffboillknjnepogjhkgnoapac|EqualWallet
cjelfplplebdjjenllpjcblmjkfcffne|JaxxxLiberty
fihkakfobkmkjojpchpfgcmhfjnmnfpi|BitAppWallet
kncchdigobghenbbaddojjnnaogfppfj|iWallet
amkmjjmmflddogmhpjloimipbofnfjih|Wombat
fhilaheimglignddkjgofkcbgekhenbh|AtomicWallet
nlbmnnijcnlegkjjpcfjclmcfggfefdm|MewCx
nanjmdknhkinifnkgdcggcfnhdaammmj|GuildWallet
nkddgncdjgjfcddamfgcmfnlhccnimig|SaturnWallet
fnjhmkhhmkbjkkabndcnnogagogbneec|RoninWallet
aiifbnbfobpmeekipheeijimdpnlpgpp|TerraStation
fnnegphlobjdpkhecapkijjdkgcjhkib|HarmonyWallet
aeachknmefphepccionboohckonoeemg|Coin98Wallet
cgeeodpfagjceefieflmdfphplkenlfk|TonCrystal
pdadjkfkgcafgbceimcpbkalnfnepbnk|KardiaChain
bfnaelmomeimhlpmgjnjophhpkkoljpa|Phantom
fhilaheimglignddkjgofkcbgekhenbh|Oxygen
mgffkfbidihjpoaomajlbgchddlicgpn|PaliWallet
aodkkagnadcbobfpggfnjeongemjbjca|BoltX
kpfopkelmapcoipemfendmdcghnegimn|LiqualityWallet
hmeobnfnfcmdkdcmlblgagmfpfboieaf|XdefiWallet
lpfcbjknijpeeillifnkikgncikgfhdo|NamiWallet
dngmlblcodfobpdpecaadgfbcggfjfnm|MaiarDeFiWallet
bhghoamapcdpbohphigoooaddinpkbai|Authenticator
ookjlbkiijinhpmnjffcofjonbfbgaoc|TempleWallet
</code></pre><h4 id=exfiltration>Exfiltration</h4><p>Placeholder</p><h4 id=remote-tasks>Remote Tasks</h4><p>Placeholder</p><h5 id=get-tasks>Get Tasks</h5><h5 id=execute-tasks>Execute Tasks</h5><p>Placeholder</p><h2 id=configuration-extraction>Configuration Extraction</h2><p>Placeholder</p><h2 id=indicators-of-compromise>Indicators of Compromise</h2><table><thead><tr><th>Type</th><th>Indicator</th><th>Description</th></tr></thead><tbody><tr><td>SHA256</td><td>532c47de5bdd433bea776290d27a741b09a1d5c5f2089e54eced922514a60799</td><td>Redline Stealer Installer File</td></tr><tr><td>SHA256</td><td>3e8d604a5d545189c35d810845b3e2208e3c56081507b949ecb17a6bbd4decb1</td><td>Messed Up PE File (Che.mp3)</td></tr><tr><td>SHA256</td><td>ac5f7f01c7ca6663810df33bfa62012368b6c17b7520943c094308f30adac766</td><td>BAT Script (Quella.mp3)</td></tr><tr><td>SHA256</td><td>454b381e98f092cab4e82f21a790c5ccd4dbd006e44925bcabd6c9289ea6700e</td><td>AutoIT Script (Travolge.mp3)</td></tr><tr><td>SHA256</td><td>3e26723394ade92f8163b5643960189cb07358b0f96529a477d37176d68aa0a0</td><td>AutoIT Interpreter</td></tr><tr><td>SHA256</td><td>454b381e98f092cab4e82f21a790c5ccd4dbd006e44925bcabd6c9289ea6700e</td><td>AutoIT Script</td></tr><tr><td>SHA256</td><td>676ae4b1ef05ee0ec754a970cce61a5f8d3093989a58c33087a3a5dca06364aa</td><td>Redline Stealer (Unpacked)</td></tr><tr><td>IPv4</td><td>95.217.35[.]153</td><td>Redline Stealer C2</td></tr></tbody></table><h2 id=detection>Detection</h2><p>This section contains signatures to detect Redline Stealer and its infection chain.</p><h3 id=yara>YARA</h3><p>Placeholder</p><h3 id=suricata>Suricata</h3><p>Placeholder</p><h2 id=mitre-attack-ttps>Mitre Attack TTPs</h2><table><thead><tr><th>ID</th><th>Tactic</th><th>Technique</th></tr></thead><tbody><tr><td>placeholder</td><td>placeholder</td><td>placeholder</td></tr></tbody></table></article><div class=my-4><a href=https://c3rb3ru5d3d53c.github.io/tags/redline/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#redline</a>
<a href=https://c3rb3ru5d3d53c.github.io/tags/stealer/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#stealer</a>
<a href=https://c3rb3ru5d3d53c.github.io/tags/reversing/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#reversing</a>
<a href=https://c3rb3ru5d3d53c.github.io/tags/analysis/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#analysis</a></div><div class=py-2><div class="my-8 flex flex-col items-center md:flex-row"><a href=https://c3rb3ru5d3d53c.github.io/authors/c3rb3ru5d3d53c/ class="md:me-4 text-primary-text h-24 w-24"><img src=https://c3rb3ru5d3d53c.github.io/images/profile.jpg class="bg-primary-bg w-full rounded-full" alt=Avatar></a><div class="mt-4 w-full md:mt-0 md:w-auto"><a href=https://c3rb3ru5d3d53c.github.io/authors/c3rb3ru5d3d53c/ class="mb-2 block border-b pb-1 text-lg font-bold"><h3>c3r3b3ru5d3d53c</h3></a><span class="block pb-2">I have acquired over my career, skills that make me a nightmare for threat actors.</span>
<a href=mailto:c3rb3ru5d3d53c@gmail.com class=me-2><i class="fas fa-envelope"></i></a>
<a href=https://twitter.com/c3rb3ru5d3d53c class=me-2><i class="fab fa-twitter"></i></a>
<a href=https://github.com/c3rb3ru5d3d53c class=me-2><i class="fab fa-github"></i></a>
<a href=https://www.youtube.com/channel/UCk9BugRahSWgPLYOAA3QH4w class=me-2><i class="fab fa-youtube"></i></a></div></div></div><div class="-mx-2 mt-4 flex flex-col border-t px-2 pt-4 md:flex-row md:justify-between"><div></div><div class="mt-4 md:mt-0 md:text-right"><span class="text-primary-text block font-bold">Next</span>
<a href=https://c3rb3ru5d3d53c.github.io/malware-blog/darkcloud-stealer/ class=block>DarkCloud Stealer Triage</a></div></div></div><div class=col-span-2><div class="bg-primary-bg
prose sticky top-16 z-10 hidden px-6 py-4 lg:block"><h3>On This Page</h3></div><div class="sticky-toc hidden px-6 pb-6 lg:block"><nav id=TableOfContents><ul><li><a href=#situation>Situation</a><ul><li><a href=#key-points>Key Points</a></li></ul></li><li><a href=#infection-chain>Infection Chain</a></li><li><a href=#obfuscated-bat-script>Obfuscated BAT Script</a><ul><li><a href=#obfuscated-autoit-script>Obfuscated AutoIT Script</a></li></ul></li><li><a href=#redline-stealer>Redline Stealer</a><ul><li><a href=#language-check>Language Check</a></li></ul></li><li><a href=#string-decryption>String Decryption</a></li><li><a href=#user-message>User Message</a><ul><li><a href=#c2-communication>C2 Communication</a><ul><li><a href=#establish-connection>Establish Connection</a></li><li><a href=#get-settings>Get Settings</a></li><li><a href=#result-data-contract>Result Data Contract</a></li></ul></li><li><a href=#modules>Modules</a><ul><li><a href=#getavs-defenders>GetAVs (defenders)</a></li><li><a href=#gethardwareinfo-hardwares>GetHardwareInfo (hardwares)</a></li><li><a href=#listofprograms-softwares>ListOfPrograms (softwares)</a></li><li><a href=#getbrowsers>GetBrowsers</a></li><li><a href=#listprocesses-processes>ListProcesses (processes)</a></li><li><a href=#languages>Languages</a></li><li><a href=#gettelegramprofiles>GetTelegramProfiles</a></li><li><a href=#stealwallets>StealWallets</a></li><li><a href=#exfiltration>Exfiltration</a></li><li><a href=#remote-tasks>Remote Tasks</a><ul><li><a href=#get-tasks>Get Tasks</a></li><li><a href=#execute-tasks>Execute Tasks</a></li></ul></li></ul></li></ul></li><li><a href=#configuration-extraction>Configuration Extraction</a></li><li><a href=#indicators-of-compromise>Indicators of Compromise</a></li><li><a href=#detection>Detection</a><ul><li><a href=#yara>YARA</a></li><li><a href=#suricata>Suricata</a></li></ul></li><li><a href=#mitre-attack-ttps>Mitre Attack TTPs</a></li></ul></nav></div><script>window.addEventListener("DOMContentLoaded",()=>{enableStickyToc()})</script></div><div class="bg-secondary-bg prose col-span-2 rounded p-6 lg:col-span-6"><h3>See Also</h3><a href=https://c3rb3ru5d3d53c.github.io/malware-blog/darkcloud-stealer/ class=no-underline>DarkCloud Stealer Triage</a><br><a href=https://c3rb3ru5d3d53c.github.io/documents/malware-reversing-rust/ class=no-underline>A Reverse Engineering Guide for Rust Binaries</a><br><a href=https://c3rb3ru5d3d53c.github.io/malware-blog/lockbit-v3-api-hashing/ class=no-underline>Reversing Additional Lockbit 3.0 API Hashing</a><br><a href=https://c3rb3ru5d3d53c.github.io/malware-blog/2022-07-04-bitter-apt-zxxz-backdoor/ class=no-underline>Making Fun of Your APT Malware - Bitter APT Using ZxxZ Backdoor to Target Pakistan Public Accounts Committee</a><br><a href=https://c3rb3ru5d3d53c.github.io/documents/what-is-a-dll/ class=no-underline>What is a DLL?</a><br><a href=https://c3rb3ru5d3d53c.github.io/documents/deobfuscating-scripts/ class=no-underline>Deobfuscating Scripts</a><br></div></div><script>document.addEventListener("DOMContentLoaded",()=>{hljs.highlightAll()})</script></div></div></main><footer class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl"><div class="text-center p-6 pin-b"><p class="text-sm text-tertiary-text">&copy; 2022 <a href=https://twitter.com/c3rb3ru5d3d53c>c3rb3ru5d3d53c</a>
&#183; Powered by the <a href=https://github.com/wangchucheng/hugo-eureka class=hover:text-eureka>Eureka</a> theme for <a href=https://gohugo.io class=hover:text-eureka>Hugo</a></p></div></div></footer></body></html>